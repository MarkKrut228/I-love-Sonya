<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <title>Game Cats</title>
    <style>
        @font-face {
            font-family: 'Press Start 2P', cursive;
            src: url('fonts/pixel.ttf') format('truetype');
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            background: url('photo/fon-game.png') no-repeat center center;
            background-size: cover;
            overflow: hidden;
            font-family: 'Press Start 2P', cursive;
        }

        /* –í–µ—Ä—Ö–Ω—î –º–µ–Ω—é */
        .top-menu {
            width: 100%;
            height: 50px;
            background-color: #222;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.7);
            position: absolute;
            top: 0;
            left: 0;
            z-index: 100;
        }

        .menu-container {
            display: flex;
            gap: 10px;
        }

        .menu-button {
            background: linear-gradient(145deg, #ff8c00, #ff6b00);
            color: white;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px;
            font-family: 'Press Start 2P', cursive;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px #000;
        }

        .menu-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .menu-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .balance {
            color: white;
            font-size: 18px;
            font-family: 'Press Start 2P', cursive;
            text-shadow: 2px 2px 4px #000;
            display: flex;
            /* –î–æ–¥–∞—î–º–æ flex-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
            align-items: center;
            /* –í–∏—Ä—ñ–≤–Ω—é—î–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—ñ */
            gap: 5px;
            /* –í—ñ–¥—Å—Ç—É–ø –º—ñ–∂ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏ */
            line-height: 1.2;
            /* –§—ñ–∫—Å—É—î–º–æ –≤–∏—Å–æ—Ç—É —Ä—è–¥–∫–∞ */
        }

        @media (max-width: 600px) {
            .top-menu {
                flex-direction: column;
                height: auto;
                padding: 10px 0;
                align-items: center;
            }

            .menu-button {
                width: 90%;
                margin: 5px 0;
                font-size: 14px;
            }

            .balance {
                font-size: 16px;
            }
        }

        .cat {
            position: absolute;
            width: 110px;
            height: 118px;
            background: url('photo/cat-game.png') no-repeat;
            background-size: 480px 960px;
            image-rendering: pixelated;
            transition: transform 0.5s linear, left 0.5s linear, top 0.5s linear;
            z-index: 5;
            filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.5));
        }

        .black-cat {
            position: absolute;
            width: 122px;
            height: 122px;
            background: url('photo/cat-black.png') no-repeat;
            background-size: 488px 976px;
            background-position: 0 0;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            transition: transform 0.5s linear, left 0.5s linear, top 0.5s linear;
            z-index: 5;
            filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.5));
        }

        .baby-cat {
    position: absolute;
    width: 122px;
    height: 122px;
    background: url('photo/cat-baby.png') no-repeat;
    background-size: 488px 976px; /* 4 –∫–∞–¥—Ä–∏ √ó 8 —Ä—è–¥–∫—ñ–≤ (—è–∫ —É —á–æ—Ä–Ω–æ–≥–æ –∫–æ—Ç–∞) */
    image-rendering: pixelated;
    image-rendering: crisp-edges;
    transition: transform 0.5s linear, left 0.5s linear, top 0.5s linear;
    z-index: 5;
    filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.5));
}

        

        #bowl {
            -webkit-tap-highlight-color: transparent;
            outline: none;
            user-select: none;
            -webkit-user-drag: none;
            filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.5));
        }

        .status-bars {
            position: absolute;
            top: 65px;
            left: 1px;
            display: flex;
            flex-direction: column;
            gap: 1px;
            z-index: 100;
            filter: drop-shadow(2px 4px 4px rgba(0, 0, 0, 0.5));
        }

        .emote {
            position: absolute;
            font-size: 28px;
            z-index: 999;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            filter: drop-shadow(2px 4px 4px rgba(0, 0, 0, 0.7));
        }

        .emote.angry {
            animation: angryBounce 0.5s infinite alternate;
            top: -20px;
            left: 35px;
        }

        .emote.sleep {
            animation: sleepZzz 2s infinite linear;
            top: -20px;
            left: 40px;
        }
        .baby-hearts {
            position: absolute;
            z-index: 999;
            pointer-events: none;
            transform: translate(-50%, -100%);
            display: none;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω—É */
        .shop-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .shop-container {
            width: 90%;
            max-width: 800px;
            height: 80%;
            background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
            border: 4px solid #8a2be2;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6),
                0 0 0 2px #ff8c00,
                0 0 0 4px #8a2be2;
            transform: scale(0.95);
            transition: all 0.3s ease;
        }

        .shop-overlay.show .shop-container {
            transform: scale(1);
        }

        .shop-header {
            background: linear-gradient(to right, #8a2be2, #4b0082);
            padding: 15px;
            display: flex;
            flex-direction: column;
            border-bottom: 3px solid #ff8c00;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }


        .shop-header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 1px;
            width: 100%;
        }

        .shop-header-top .balance {
            font-size: 14px;
            color: white;
            flex: 1;
            text-align: left;
        }

        .shop-title {
            background: linear-gradient(145deg, #ff8c00, #ff6b00);
            color: white;
            font-size: 14px;
            padding: 10px 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            text-shadow: 1px 1px 2px #000;
            border: 2px solid #8a2be2;
            margin: 0 10px;
            text-align: center;
            flex: 2;
        }

        .shop-title:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }


        .categories-container {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 10px 1px;
            scrollbar-width: thin;
            scrollbar-color: #8a2be2 #333;
        }

        .categories-container::-webkit-scrollbar {
            height: 6px;
        }

        .categories-container::-webkit-scrollbar-track {
            background: #333;
            border-radius: 3px;
        }

        .categories-container::-webkit-scrollbar-thumb {
            background: linear-gradient(#8a2be2, #4b0082);
            border-radius: 3px;
        }

        .category {
            background: linear-gradient(145deg, #3a3a3a, #2d2d2d);
            border: 2px solid #8a2be2;
            border-radius: 8px;

            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            position: relative;
            margin-right: 8px;
            min-width: 120px;
            min-height: 40px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 7px;
        }

        .category:last-child {
            margin-right: 0;
        }

        .category.locked {
            background: linear-gradient(145deg, #555, #333) !important;
            border-color: #888 !important;
            color: #bbb !important;
            cursor: not-allowed !important;
            opacity: 1 !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.10);
            min-width: 120px;
            min-height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 7px;
        }

        .category.locked .lock-icon {
            display: inline-block;
            font-size: 16px;
            vertical-align: middle;
            margin-right: 0;
        }

        .category:not(:last-child)::after {
            content: '';
            position: absolute;
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 60%;
            background: rgba(255, 255, 255, 0.2);
        }

        .category:hover {
            background: linear-gradient(145deg, #4a4a4a, #3d3d3d);
            transform: translateY(-2px);
        }

        .category.active {
            background: linear-gradient(145deg, #8a2be2, #4b0082);
            border-color: #ff8c00;
            box-shadow: 0 0 10px rgba(138, 43, 226, 0.7);
        }

        .close-shop {
            background: #ff4444;
            border: none;
            color: white;
            font-size: 24px;
            /* –ó–±—ñ–ª—å—à–µ–Ω–∏–π —Ä–æ–∑–º—ñ—Ä */
            font-weight: bold;
            /* –ñ–∏—Ä–Ω–∏–π —à—Ä–∏—Ñ—Ç */
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            text-shadow: 1px 1px 2px #000;
            flex: 0 0 auto;
            /* –§—ñ–∫—Å–æ–≤–∞–Ω–∞ —à–∏—Ä–∏–Ω–∞ */
            width: 44px;
            /* –ó–±—ñ–ª—å—à–µ–Ω–∞ —à–∏—Ä–∏–Ω–∞ */
            height: 44px;
            /* –ó–±—ñ–ª—å—à–µ–Ω–∞ –≤–∏—Å–æ—Ç–∞ */
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: -1px;
            /* –í—ñ–¥—Å—Ç—É–ø –∑–ª—ñ–≤–∞ */
            position: relative;
            /* –î–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∑–∏—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è */
            right: 0;
            /* –§—ñ–∫—Å—É—î–º–æ –ø—Ä–∞–≤–æ—Ä—É—á */
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        /* –ó–±—ñ–ª—å—à–µ–Ω–∏–π —Ö—Ä–µ—Å—Ç–∏–∫ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–Ω—ñ */
        .close-shop:hover {
            background: #ff0000;
            transform: rotate(90deg) scale(1.1);
            /* –î–æ–¥–∞–Ω–æ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è */
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è —Ä–æ–∑–¥—ñ–ª—å–Ω–æ—ó –ª—ñ–Ω—ñ—ó */
        .divider {
            height: 2px;
            background: linear-gradient(to right, transparent, #8a2be2, #ff8c00, #8a2be2, transparent);
            margin: 5px 0;
            width: 100%;
        }

        .shop-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            padding: 15px;
            overflow-y: auto;
            height: calc(100% - 150px);
        }

        .shop-item {
            background: linear-gradient(145deg, #3a3a3a, #2d2d2d);
            border: 2px solid #8a2be2;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            /* –ó–º—ñ–Ω–∞ –∑ row –Ω–∞ column */
            align-items: center;
            /* –¶–µ–Ω—Ç—Ä—É—î–º–æ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—ñ */
            text-align: center;
            /* –¶–µ–Ω—Ç—Ä—É—î–º–æ —Ç–µ–∫—Å—Ç */
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            min-height: 210px;
            height: auto;
            width: 90%;
            /* –î–æ–¥–∞—î–º–æ —à–∏—Ä–∏–Ω—É –¥–ª—è –∫—Ä–∞—â–æ–≥–æ –≤–∏–≥–ª—è–¥—É */
            max-width: 400px;
            /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —à–∏—Ä–∏–Ω–∞ */
            margin: 0 auto;
            /* –¶–µ–Ω—Ç—Ä—É—î–º–æ –±–ª–æ–∫ —Ç–æ–≤–∞—Ä—É */
        }

        .shop-item::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(to bottom right,
                    rgba(138, 43, 226, 0.1),
                    rgba(255, 140, 0, 0.1));
            transform: rotate(45deg);
            z-index: 0;
        }

        .shop-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            border-color: #ff8c00;
        }

        /* –ê–¥–∞–ø—Ç–∞—Ü—ñ—è –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ */
        @media (max-width: 600px) {
            .shop-content {
                padding: 10px;
                gap: 10px;
            }

            .shop-item {
                margin-bottom: 10px;
            }

            .close-shop {
                font-size: 20px;
                width: 40px;
                height: 40px;
            }
        }

        .item-image {
            width: 120px;
            height: 120px;
            background-color: #222; /* —Ç–µ–º–Ω–∏–π —Ñ–æ–Ω, —â–æ–± –Ω–µ –±—É–ª–æ –ø—Ä–æ–∑–æ—Ä–æ–≥–æ */
            margin-right: 20px;
            border: 3px solid #555;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            z-index: 1;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            flex-shrink: 0;
            background-size: contain;      /* –ø–æ–∫–∞–∑—É—î –≤—Å—é –∫–∞—Ä—Ç–∏–Ω–∫—É */
            background-repeat: no-repeat;  /* –Ω–µ –ø–æ–≤—Ç–æ—Ä—é—î */
            background-position: center;
        }

        .item-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            /* –¶–µ–Ω—Ç—Ä—É—î–º–æ –≤–º—ñ—Å—Ç */
            width: 100%;
            /* –ó–∞–π–º–∞—î –≤—Å—é —à–∏—Ä–∏–Ω—É –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç—É */
        }

        .item-name {
            color: white;
            font-size: 14px;
            margin-bottom: 10px;
            text-align: center;
            /* –¶–µ–Ω—Ç—Ä—É—î–º–æ —Ç–µ–∫—Å—Ç */
            z-index: 1;
            text-shadow: 1px 1px 2px #000;
            width: 100%;
            /* –ó–∞–π–º–∞—î –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É —à–∏—Ä–∏–Ω—É */
        }

        .item-price {
            color: #ff8c00;
            font-size: 16px;
            margin-bottom: 15px;
            z-index: 1;
            text-shadow: 1px 1px 2px #000;
            text-align: center;
            /* –¶–µ–Ω—Ç—Ä—É—î–º–æ —Ç–µ–∫—Å—Ç */
        }

        .buy-button {
            background: linear-gradient(145deg, #8a2be2, #4b0082);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            text-shadow: 1px 1px 2px #000;
            border: 1px solid #ff8c00;
            z-index: 1;
            width: auto;
            /* –ó–º—ñ–Ω–∞ –∑ 100% –Ω–∞ auto */
            max-width: 200px;
            margin: 0 auto;
            /* –¶–µ–Ω—Ç—Ä—É—î–º–æ –∫–Ω–æ–ø–∫—É */
        }

        .buy-button:hover {
            background: linear-gradient(145deg, #9932cc, #5a1d9c);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }

        .buy-button:active {
            transform: translateY(1px);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .buy-button.loading {
            position: relative;
            color: transparent;
            pointer-events: none;
        }

        .buy-button.loading::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        @keyframes angryBounce {
            from {
                transform: translateY(0);
            }

            to {
                transform: translateY(-10px);
            }
        }

        @keyframes sleepZzz {
            0% {
                transform: translateY(0);
                opacity: 1;
            }

            100% {
                transform: translateY(-30px);
                opacity: 0;
            }
        }

        /* –°–º—É–≥–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        .shop-content::-webkit-scrollbar {
            width: 10px;
        }

        .shop-content::-webkit-scrollbar-track {
            background: #333;
            border-radius: 5px;
        }

        .shop-content::-webkit-scrollbar-thumb {
            background: linear-gradient(#8a2be2, #4b0082);
            border-radius: 5px;
            border: 1px solid #ff8c00;
        }

        .shop-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(#9932cc, #5a1d9c);
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –≤—ñ–∫–Ω–∞ –∑–∞–≤–¥–∞–Ω—å */
        .tasks-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            opacity: 0;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .tasks-container {
            width: 90%;
            max-width: 600px;
            height: 70%;
            background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
            border: 4px solid #ff8c00;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6),
                0 0 0 2px #8a2be2,
                0 0 0 4px #ff8c00;
        }

        .tasks-header {
            background: linear-gradient(to right, #ff8c00, #ff6b00);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #8a2be2;
        }

        .tasks-title {
            color: white;
            font-size: 18px;
            text-align: center;
            flex-grow: 1;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .close-tasks {
            background: #8a2be2;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .tasks-content {
            padding: 20px;
            overflow-y: auto;
            background: rgba(30, 30, 30, 0.7);
        }

        .task-item {
            background: rgba(50, 50, 50, 0.7);
            border: 2px solid #8a2be2;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-info {
            flex-grow: 1;
        }

        .task-name {
            color: white;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .task-reward {
            color: #ff8c00;
            font-size: 12px;
        }

        .task-button {
            background: linear-gradient(145deg, #8a2be2, #4b0082);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            cursor: pointer;
        }

        /* –ê–¥–∞–ø—Ç–∞—Ü—ñ—è –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ */
        @media (max-width: 600px) {
            .shop-item {
                flex-direction: column;
                padding: 15px;
            }

            .item-image {
                width: 100px;
                height: 100px;
                margin-right: 0;
                margin-bottom: 15px;
            }

            .buy-button {
                max-width: 100%;
                width: 100%;
            }
        }

        /* –°–º—É–≥–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        .shop-content::-webkit-scrollbar {
            width: 12px;
        }

        .shop-content::-webkit-scrollbar-track {
            background: #333;
            border-radius: 6px;
        }

        .shop-content::-webkit-scrollbar-thumb {
            background: linear-gradient(#8a2be2, #4b0082);
            border-radius: 6px;
            border: 2px solid #ff8c00;
        }

        .shop-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(#9932cc, #5a1d9c);
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è */
        .buy-button.loading {
            position: relative;
            color: transparent;
            pointer-events: none;
        }

        .buy-button.loading::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –∫–æ—Ä–º—É */
        .food-category .item-image {
            background-color: #8a5a44;
            border-color: #6d4c3a;
        }

        .placement-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1002;
        }

        .placement-container {
            background: #222;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            color: white;
            width: 80%;
            max-width: 400px;
        }

        .placement-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .placement-grid div {
            background: #444;
            border: 2px solid #8a2be2;
            border-radius: 5px;
            height: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .placement-grid div:hover {
            background: #555;
            border-color: #ff8c00;
        }

        .cancel-placement {
            background: #ff4444;
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cancel-placement:hover {
            background: #ff0000;
        }

        .placement-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 1003;
        }

        .placement-button {
            background: #0da33d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Press Start 2P', cursive;
            transition: all 0.3s ease;
        }

        .placement-button:hover {
            background: #6d1dbb;
        }

        .placement-button.cancel {
            background: #ff4444;
        }

        .placement-button.cancel:hover {
            background: #ff0000;
        }

        .placed-item {
            position: absolute;
            width: 60px;
            height: 85px;
            background-size: cover;
            background-position: center;
            z-index: 1;
            cursor: move;
        }

        .move-button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            z-index: 6;
            transition: all 0.3s ease;
            margin: 580px 6px 1px 1px;
            /* –≤–µ—Ä—Ö, –ø—Ä–∞–≤–æ, –Ω–∏–∑, –ª—ñ–≤–æ */
        }

        .move-button:hover {
            background: #45a049;
        }

        .placed-item.tumb {
            width: 90px;
            height: 90px;
        }

        .placed-item.picture {
            width: 70px;
            height: 90px;
        }

        .item-image.picture {
            box-shadow: 6px 10px 24px 0 rgba(60, 40, 20, 0.32);
            border-radius: 8px;
            background-color: transparent;
            position: relative;
        }


        .item-image.picture::after {
            content: '';
            position: absolute;
            left: 12px;
            right: 12px;
            top: 12px;
            bottom: 12px;
            border-radius: 8px;
            box-shadow: 6px 10px 24px 0 rgba(60, 40, 20, 0.32);
            z-index: 0;
            pointer-events: none;
        }

        .item-image.picture {
            position: relative;
            z-index: 1;
        }

        .placed-item.toy {
            width: 50px;
            height: 50px;
        }

        .shop-item.purchased {
            opacity: 0.7;
        }

        .purchased-label {
            color: #fff;
            background: #4caf50;
            border-radius: 6px;
            padding: 6px 14px;
            font-size: 13px;
            font-family: 'Press Start 2P', cursive;
            margin-bottom: 8px;
            margin-top: 8px;
            display: inline-block;
        }

        .delete-button {
            background: #ff4444 !important;
            color: #fff !important;
            z-index: 10000 !important;
            position: relative !important;
            min-height: 32px !important;
            font-size: 18px !important;
            border: none;
            border-radius: 6px;
            padding: 6px 14px;
            font-size: 13px;
            font-family: 'Press Start 2P', cursive;
            cursor: pointer;
            margin-top: 6px;
            display: block;
            transition: background 0.2s;
            width: 100%;
            box-sizing: border-box;
        }

        .delete-button:hover {
            background: #c62828;
        }

        .shop-item.purchased {
            min-height: 255px;
        }

        /* –î–ª—è –º–∏—Å–æ–∫ –Ω–µ –∑–±—ñ–ª—å—à—É—î–º–æ —Ä–æ–∑–º—ñ—Ä –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –∫—É–ø–ª–µ–Ω–æ */
        .shop-item.purchased.food-category,
        .shop-item.purchased:not(.food-category):has(.item-name:contains('–ú–∏—Å–∫–∏')) {
            min-height: 210px !important;
        }

        .shop-item.purchased.miska {
            min-height: 210px !important;
        }

        .delete-modal-content {
            background: #222;
            color: #fff;
            border-radius: 16px;
            padding: 28px 18px 22px 18px;
            min-width: 220px;
            max-width: 260px;
            width: 92vw;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.7), 0 0 0 3px #ff8c00, 0 0 0 6px #8a2be2;
            border: 3px solid #ff8c00;
            text-align: center;
            font-family: 'Press Start 2P', cursive;
            position: relative;
            margin: 0 auto;
            font-size: 15px;
        }

        .delete-modal-title {
            font-size: 15px;
            margin-bottom: 22px;
            font-family: 'Press Start 2P', cursive;
            color: #fff;
            text-shadow: 2px 2px 4px #000;
            word-break: break-word;
        }

        .delete-modal-buttons {
            display: flex;
            justify-content: center;
            gap: 18px;
        }

        .delete-modal-btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 13px;
            border: none;
            border-radius: 8px;
            padding: 10px 28px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: background 0.2s, color 0.2s, transform 0.2s;
            outline: none;
        }

        .delete-modal-btn.yes {
            background: linear-gradient(145deg, #ff8c00, #ff4444);
            color: #fff;
            border: 2px solid #ff8c00;
            text-shadow: 1px 1px 2px #000;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —ñ–Ω—Ñ–æ —É —Ä–æ–∑–¥—ñ–ª—ñ –§–∞—Ä–º */
        .farm-info-btn {
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 14px;
            cursor: pointer;
            margin-left: 8px;
            font-family: 'Press Start 2P', cursive;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            vertical-align: middle;
            transition: background 0.2s;
        }

        .farm-info-btn:hover {
            background: #357abd;
        }

        .buy-container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .delete-modal-btn.yes:hover {
            background: linear-gradient(145deg, #ff4444, #ff8c00);
            color: #fff;
            transform: scale(1.05);
        }

        .delete-modal-btn.no {
            background: #444;
            color: #fff;
            border: 2px solid #8a2be2;
            text-shadow: 1px 1px 2px #000;
        }

        .delete-modal-btn.no:hover {
            background: #8a2be2;
            color: #fff;
            transform: scale(1.05);
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–≤–æ—Ä–æ—Ç –µ–∫—Ä–∞–Ω—É */
        .rotate-screen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: url('photo/vertically.png') no-repeat center center;
            background-size: cover;
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .rotate-screen-message {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-family: 'Press Start 2P', cursive;
            font-size: 16px;
            max-width: 80%;
        }

        /* –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–≤–æ—Ä–æ—Ç —Ç—ñ–ª—å–∫–∏ –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ */
        @media (orientation: landscape) and (max-height: 600px) {
            .rotate-screen-overlay {
                display: flex;
            }
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –£—Ä–æ–∂–∞–π */
        .harvest-button {
            background: #ff9800;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: background 0.2s;
        }

        .harvest-button:hover {
            background: #e68900;
        }

        .placed-item.farm {
            width: 100px !important;
            height: 155px !important;
            background-size: contain !important;
            background-repeat: no-repeat;
            background-position: center;
            overflow: visible !important;
            margin-bottom: 10px;
            z-index: 2;
        }

        .flower-img {
            width: 50px;
            height: 85px;
            object-fit: contain;
            transition: filter 0.3s;
            z-index: 3;
        }

        .harvest-flower-btn {
            background: #ff9800;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 7px 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 11px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: background 0.2s;
            z-index: 3;
            margin-top: 32px;
            /* –ë—ñ–ª—å—à–∏–π –≤—ñ–¥—Å—Ç—É–ø, —â–æ–± –∫–Ω–æ–ø–∫–∞ –±—É–ª–∞ –Ω–∏–∂—á–µ –∫–≤—ñ—Ç–∫–∏ */
        }

        .harvest-flower-btn:hover {
            background: #e68900;
        }

        .flower-img.small {
            width: 35px;
            height: 50px;
            z-index: 3;
        }

        .cactus-img.small {
            width: 31px;
            height: 26px;
            margin-left: 4px;
            z-index: 3;
            margin-top: 10px;
        }

        .cactus-img.stage2 {
            width: 26px;
            height: 36px;
            margin-left: 4px;
            z-index: 3;
        }

        .cactus-img.stage3 {
            width: 27px;
            height: 53px;
            margin-left: 5px;
            z-index: 3;
        }

        .cactus-img.stage4 {
            width: 40px;
            height: 65px;
            margin-left: 18px;
            z-index: 3;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Ä–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è –§–∞—Ä–º */
        #farmLockModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        #farmLockModal .modal-content {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #farmLockModal img {
            max-width: 90vw;
            max-height: 60vh;
            border-radius: 18px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.5);
        }

        #farmLockModal .modal-text {
            position: absolute;
            top: 32%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #000000;
            font-family: 'Press Start 2P', cursive;
            font-size: 16px;
            text-align: center;
            padding: 10px 20px;
            border-radius: 10px;
            pointer-events: none;
        }

        .category .farm-text {
            font-size: 12px;
            color: inherit;
            font-family: inherit;
            font-weight: normal;
            letter-spacing: inherit;
            margin: 0 2px;
        }

        #farmLockModal .ok-overlay-btn {
            position: absolute;
            left: 48%;
            top: 80%;
            /* –ø—ñ–¥–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø—ñ–¥ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏ Ok –Ω–∞ —Ñ–æ—Ç–æ */
            transform: translate(-50%, -50%);
            width: 120px;
            /* –ø—ñ–¥–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø—ñ–¥ —Ä–æ–∑–º—ñ—Ä –∫–Ω–æ–ø–∫–∏ Ok –Ω–∞ —Ñ–æ—Ç–æ */
            height: 42px;
            background: none;
            border: none;
            opacity: 0;
            cursor: pointer;
            z-index: 2;
        }

        /* –î–æ–¥–∞—é —Å—Ç–∏–ª—ñ –¥–ª—è –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è –∫–≤—ñ—Ç–æ—á–æ–∫ —É flowerGallery */
        #flowerGallery {
            min-height: 155px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            position: relative;
            /* –≤–∂–µ —î position: absolute, —è–∫—â–æ –Ω—ñ ‚Äî –¥–æ–¥–∞—Ç–∏ */
            position: absolute;
        }

        .flower-img {
            position: static;
            height: 82px;
            width: auto;
            object-fit: contain;
            left: unset;
            bottom: unset;
            transform: none;
        }

        .harvest-flower-btn {
            margin-top: 8px;
        }

        /* –ê–Ω—ñ–º–∞—Ü—ñ—è bounce –¥–ª—è –Ω–∞–ø–∏—Å—É '–ó–∞–±–µ—Ä–∏ —É—Ä–æ–∂–∞–π' */
        @keyframes bounce-harvest-label {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(18px);
            }

            100% {
                transform: translateY(0);
            }
        }

        .harvest-label {
            font-family: 'Press Start 2P', cursive;
            font-size: 15px;
            color: #ff9800;
            margin-bottom: 18px;
            /* –ü—ñ–¥–Ω—è—Ç–∏ –≤–∏—â–µ */
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 4;
            text-shadow: 2px 2px 0 #222, -2px 2px 0 #222, 2px -2px 0 #222, -2px -2px 0 #222, 0 2px 0 #222, 2px 0 0 #222, 0 -2px 0 #222, -2px 0 0 #222;
            animation: bounce-harvest-label 2.2s infinite;
            position: absolute;
            top: -38px;
            left: 50%;
            transform: translateX(-50%);
            width: max-content;
            pointer-events: none;
        }

        /* –î–æ–¥–∞—é/–æ–Ω–æ–≤–ª—é—é CSS –¥–ª—è .harvest-label */
        .harvest-label {
            position: absolute;
            left: -74%;
            top: auto;
            bottom: 59%;
            transform: translateX(-50%);
            width: max-content;
            pointer-events: none;
        }
        .harvest-label-cactus {
            position: absolute;
            left: -20%;
            top: auto;
            bottom: 47%;
            transform: translateX(-50%);
            font-family: 'Press Start 2P', cursive;
            font-size: 15px;
            color: #ff9800;
            margin-bottom: 18px;
            /* –ü—ñ–¥–Ω—è—Ç–∏ –≤–∏—â–µ */
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 4;
            text-shadow: 2px 2px 0 #222, -2px 2px 0 #222, 2px -2px 0 #222, -2px -2px 0 #222, 0 2px 0 #222, 2px 0 0 #222, 0 -2px 0 #222, -2px 0 0 #222;
            animation: bounce-harvest-label 2.2s infinite;
            position: absolute;
            width: max-content;
            pointer-events: none;
        }

        /* –°—Ç—Ä—ñ–ª–æ—á–∫–∞ –¥–ª—è –≥—Ä–∏–±–æ—á–∫–∞: –ø–æ —Ü–µ–Ω—Ç—Ä—É –Ω–∞–¥ –≥—Ä–∏–±–æ–º —á–µ—Ä–µ–∑ —Ñ–ª–µ–∫—Å-–∫–æ–ª–æ–Ω–∫—É #flowerGallery */
        .harvest-label-mushroom {
            position: static;
            font-family: 'Press Start 2P', cursive;
            font-size: 15px;
            color: #ff9800;
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 4;
            text-shadow: 2px 2px 0 #222, -2px 2px 0 #222, 2px -2px 0 #222, -2px 0 0 #222, 0 2px 0 #222, 2px 0 0 #222, 0 -2px 0 #222, -2px 0 0 #222;
            animation: bounce-harvest-label 2.2s infinite;
            width: max-content;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–≤–æ—Ä–æ—Ç –µ–∫—Ä–∞–Ω—É -->
    <div class="rotate-screen-overlay" id="rotateScreenOverlay">
        <div class="rotate-screen-message">
            –ë—É–¥—å –ª–∞—Å–∫–∞, –ø–æ–≤–µ—Ä–Ω—ñ—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ!
        </div>
    </div>

    <!-- –í–µ—Ä—Ö–Ω—î –º–µ–Ω—é -->
    <div class="top-menu">
        <div class="menu-container">
            <div class="balance">–ë–∞–ª–∞–Ω—Å <br> ü™ô0</div>
            <button class="menu-button" onclick="openShop()">–ú–∞–≥–∞–∑–∏–Ω</button>
            <button class="menu-button" onclick="goBack()">–ù–∞–∑–∞–¥</button>
        </div>
        <div class="status-bars">
            <img id="hungerBar" class="bar" src="images/hungry_0.png" style="width: 170px; height: 55px;">
            <img id="energyBar" class="bar" src="images/energy_0.png" style="width: 170px; height: 55px;">
        </div>
    </div>
    <div style="z-index: 5;" class="cat"></div>
    <div style="z-index: 5; display: none;" class="black-cat"></div>
    <div id="emote" class="emote"></div>
    <div class="baby-cat" style="display: none;"></div>
    <img id="babyHearts" class="baby-hearts" src="photo/hearts.gif" alt="hearts">

    <!-- –ú–∞–≥–∞–∑–∏–Ω -->
    <div class="shop-overlay" id="shopOverlay">
        <div class="shop-container">
            <div class="shop-header">
                <div class="shop-header-top">
                    <div class="balance">–ë–∞–ª–∞–Ω—Å <br> ü™ô0</div>
                    <div class="shop-title" id="tasksButton">–ó–ê–í–î–ê–ù–ù–Ø</div>
                    <button class="close-shop" onclick="closeShop()">‚úï</button>
                </div>
                <div class="categories-container" id="categoriesContainer">
                    <!-- –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
            <div class="shop-content" id="shopContent">
                <!-- –¢–æ–≤–∞—Ä–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è —Ä–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è –¢–∞—î–º–Ω–æ—ó -->
    <div id="secretUnlockModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:2000; justify-content:center; align-items:center; font-family: 'Press Start 2P', cursive;">
        <div class="delete-modal-content">
            <div class="delete-modal-title">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è ¬´–¢–∞—î–º–Ω–∞¬ª –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∞</div>
            <div class="delete-modal-title" style="font-size:14px;">–í–∞—Ä—Ç—ñ—Å—Ç—å —Ä–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è: ü™ô<span id="secretUnlockPriceLabel">111</span></div>
            <div class="delete-modal-buttons">
                <button id="secretUnlockBuyBtn" class="delete-modal-btn yes">–ö—É–ø–∏—Ç–∏</button>
                <button id="secretUnlockCancelBtn" class="delete-modal-btn no">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- –í—ñ–∫–Ω–æ –∑–∞–≤–¥–∞–Ω—å -->
    <div class="tasks-overlay" id="tasksOverlay">
        <div class="tasks-container">
            <div class="tasks-header">
                <div class="tasks-title">–©–û–î–ï–ù–ù–Ü –ó–ê–í–î–ê–ù–ù–Ø</div>
                <button class="close-tasks" onclick="closeTasks()">‚úï</button>
            </div>
            <div class="tasks-content" id="tasksContent">
                <!-- –ó–∞–≤–¥–∞–Ω–Ω—è –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
    </div>

    <!-- –í—ñ–∫–Ω–æ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è -->
    <div class="placement-overlay" id="placementOverlay">
        <div class="placement-container">
            <h3>–í–∏–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ü–µ –¥–ª—è —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è</h3>
            <div class="placement-grid" id="placementGrid">
                <!-- –ö–ª—ñ–∫–∞–±–µ–ª—å–Ω—ñ –º—ñ—Å—Ü—è –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            <button class="cancel-placement" onclick="cancelPlacement()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
    </div>

    <div class="placement-controls" id="placementControls" style="display: none;">
        <button class="placement-button" onclick="finalizePlacement()">–ì–æ—Ç–æ–≤–æ</button>
        <button class="placement-button cancel" onclick="cancelPlacement()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è -->
    <div id="deleteConfirmModal"
        style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:2000; justify-content:center; align-items:center; font-family: 'Press Start 2P', cursive;">
        <div class="delete-modal-content">
            <div class="delete-modal-title">–í–∏ —Ç–æ—á–Ω–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –ø—Ä–µ–¥–º–µ—Ç?</div>
            <div class="delete-modal-buttons">
                <button id="deleteConfirmYes" class="delete-modal-btn yes">–¢–∞–∫</button>
                <button id="deleteConfirmNo" class="delete-modal-btn no">–ù—ñ</button>
            </div>
        </div>
    </div>

    <!-- –ì–∞–ª–µ—Ä–µ—è —Ä–æ—Å—Ç—É –∫–≤—ñ—Ç–æ—á–∫–∏ -->
    <div id="flowerGallery" style="display: none; flex-direction: column; align-items: center; margin-top: 70px;"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ–≥–æ –§–∞—Ä–º -->
    <div id="farmLockModal">
        <div class="modal-content" style="position:relative;">
            <img src="photo/cat-message.png" alt="cat-message">
            <button class="ok-overlay-btn" onclick="closeFarmLockModal()"></button>
            <div class="modal-text">–†–æ–∑–±–ª–æ–∫—É—î—Ç—å—Å—è –ø—Ä–∏ –ø–æ–∫—É–ø—Ü—ñ —Ç—É–º–±–æ—á–∫–∏.</div>
        </div>
    </div>

    <script>
        const cat = document.querySelector('.cat');
        const blackCat = document.querySelector('.black-cat');
        let isSitting = false;
        let isLying = false;
        let isClicked = false;
        let frame = 0;
        let direction = 0;
        let speed = 0.7;
        let lastDirection = -1;
        let repeatMove = false;
        let walkTimeout, restTimeout;

        const startX = window.innerWidth / 2 - 48;
        const startY = window.innerHeight * 0.7;
        cat.style.left = `${startX}px`;
        cat.style.top = `${startY}px`;
        const babyCat = document.querySelector('.baby-cat');
        const babyHearts = document.getElementById('babyHearts');
        let coins = 0;
        let isSecretUnlocked = false;
        const SECRET_UNLOCK_PRICE = 111;
        const BOWL_FEED_COST = 10;
        const FARM_STAGE_MS = 60 * 60 * 1000;
        const HARVEST_REWARD_FLOWER = 15;
        const HARVEST_REWARD_CACTUS = 30;
        const HARVEST_REWARD_MUSHROOM = 50;
        const FALL_COIN_INTERVAL_MS = 20 * 60 * 1000;
        const FALL_COIN_REWARD = 10;
        function saveGameState() {
            const placedItemsData = [];
            document.querySelectorAll('.placed-item').forEach(el => {
                let category = el.dataset.category;
                let id = parseInt(el.dataset.id);

                // Fallback –¥–ª—è —Å—Ç–∞—Ä–∏—Ö –∑–±–µ—Ä–µ–∂–µ–Ω—å
                if (!category) {
                    if (el.classList.contains('tumb')) category = '–¢—É–º–±–æ—á–∫–∏';
                    else if (el.classList.contains('picture')) category = '–ö–∞—Ä—Ç–∏–Ω–∏';
                    else if (el.classList.contains('toy')) category = '–Ü–≥—Ä–∞—à–∫–∏';
                    else category = '–õ–∞–º–ø–∏';
                }
                if (isNaN(id)) {
                    let bg = el.style.backgroundImage;
                    let match = bg.match(/_(\d+)\.png/);
                    id = match ? parseInt(match[1]) : 0;
                }

                placedItemsData.push({
                    category: category,
                    id: id,
                    left: el.style.left,
                    top: el.style.top
                });
            });

            const state = {
                coins,
                isSecretUnlocked,
                currentBowlId,
                purchasedItems,
                hungerStage,
                energyStage,
                tasksState,
                placedItems: placedItemsData,
                farm: {
                    flower: { stage: typeof flowerCurrentStage !== 'undefined' ? flowerCurrentStage : 0, nextTs: typeof flowerNextTs !== 'undefined' ? flowerNextTs : 0 },
                    cactus: { stage: typeof cactusCurrentStage !== 'undefined' ? cactusCurrentStage : 0, nextTs: typeof cactusNextTs !== 'undefined' ? cactusNextTs : 0 },
                    mushroom: { stage: typeof mushroomCurrentStage !== 'undefined' ? mushroomCurrentStage : 0, nextTs: typeof mushroomNextTs !== 'undefined' ? mushroomNextTs : 0 }
                }
            };
            try {
                localStorage.setItem('gameState', JSON.stringify(state));
            } catch (e) {}
        }

        function restorePlacedItems(items) {
            if (!Array.isArray(items)) return;
            
            // –û—á–∏—â–∞—î–º–æ —ñ—Å–Ω—É—é—á—ñ —Ä–æ–∑—Å—Ç–∞–≤–ª–µ–Ω—ñ –ø—Ä–µ–¥–º–µ—Ç–∏ –ø–µ—Ä–µ–¥ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è–º (—â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –¥—É–±–ª—ñ–≤)
            document.querySelectorAll('.placed-item').forEach(el => el.remove());

            items.forEach(item => {
                const el = document.createElement('div');
                el.className = 'placed-item';
                el.dataset.category = item.category;
                el.dataset.id = item.id;
                if (item.category === '–¢—É–º–±–æ—á–∫–∏') el.classList.add('tumb');
                if (item.category === '–ö–∞—Ä—Ç–∏–Ω–∏') {
                    el.classList.add('picture');
                    el.style.transform = getPictureRotation(item.id);
                }
                if (item.category === '–Ü–≥—Ä–∞—à–∫–∏') el.classList.add('toy');

                el.style.backgroundImage = (item.category === '–Ü–≥—Ä–∞—à–∫–∏')
                    ? `url('shop/toy_${item.id}.png')`
                    : `url('shop/${item.category}_${item.id}.png')`;
                
                el.style.left = item.left;
                el.style.top = item.top;
                el.style.position = 'absolute';
                document.body.appendChild(el);

                // –Ø–∫—â–æ —Ü–µ —Ç—É–º–±–æ—á–∫–∞, –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –≤ –Ω—ñ–π –º–∞—î –±—É—Ç–∏ —Ä–æ—Å–ª–∏–Ω–∞
                if (item.category === '–¢—É–º–±–æ—á–∫–∏') {
                    const farmItem = purchasedItems.find(p => normalizeCategory(p.category) === '–§–∞—Ä–º');
                    if (farmItem) {
                        setTimeout(() => {
                            const gallery = document.getElementById('flowerGallery');
                            if (gallery) {
                                gallery.style.display = 'flex';
                                gallery.style.position = 'absolute';
                                gallery.style.left = '50%';
                                gallery.style.bottom = '79%';
                                gallery.style.transform = 'translateX(-50%)';
                                gallery.style.zIndex = '10';
                                el.appendChild(gallery);
                                
                                // –ó–∞–ø—É—Å–∫–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É –≥–∞–ª–µ—Ä–µ—é
                                if (farmItem.id === 1) renderFlowerGallery();
                                else if (farmItem.id === 2) renderCactusGallery();
                                else if (farmItem.id === 3) renderMushroomGallery();
                            }
                        }, 200);
                    }
                }
            });
        }

        function loadGameState() {
            try {
                const raw = localStorage.getItem('gameState');
                if (!raw) return;
                const s = JSON.parse(raw);
                if (typeof s.coins === 'number') coins = s.coins;
                if (typeof s.isSecretUnlocked === 'boolean') isSecretUnlocked = s.isSecretUnlocked;
                if (typeof s.currentBowlId === 'number') currentBowlId = s.currentBowlId;
                if (Array.isArray(s.purchasedItems)) purchasedItems = s.purchasedItems;
                if (typeof s.hungerStage === 'number') hungerStage = s.hungerStage;
                if (typeof s.energyStage === 'number') energyStage = s.energyStage;
                if (s.tasksState) tasksState = { ...tasksState, ...s.tasksState };
                
                if (s.farm && s.farm.flower) {
                    flowerCurrentStage = s.farm.flower.stage || 0;
                    flowerNextTs = s.farm.flower.nextTs || 0;
                    const now = nowMs();
                    while (flowerNextTs && now >= flowerNextTs && flowerCurrentStage < 3) {
                        flowerCurrentStage++;
                        flowerNextTs += FARM_STAGE_MS;
                    }
                    if (flowerNextTs > 0) startFlowerInterval();
                }
                if (s.farm && s.farm.cactus) {
                    cactusCurrentStage = s.farm.cactus.stage || 0;
                    cactusNextTs = s.farm.cactus.nextTs || 0;
                    const now = nowMs();
                    while (cactusNextTs && now >= cactusNextTs && cactusCurrentStage < 3) {
                        cactusCurrentStage++;
                        cactusNextTs += FARM_STAGE_MS;
                    }
                    if (cactusNextTs > 0) startCactusInterval();
                }
                if (s.farm && s.farm.mushroom) {
                    mushroomCurrentStage = s.farm.mushroom.stage || 0;
                    mushroomNextTs = s.farm.mushroom.nextTs || 0;
                    const now = nowMs();
                    while (mushroomNextTs && now >= mushroomNextTs && mushroomCurrentStage < 3) {
                        mushroomCurrentStage++;
                        mushroomNextTs += FARM_STAGE_MS;
                    }
                    if (mushroomNextTs > 0) startMushroomInterval();
                }

                if (Array.isArray(s.placedItems)) {
                    restorePlacedItems(s.placedItems);
                }
            } catch (e) {}
        }
        // --- –°—Ç–∞–Ω –∑–∞–≤–¥–∞–Ω—å ---
        const DAY_MS = 24 * 60 * 60 * 1000;
        let tasksState = {
            dailyLogin: { nextAvailable: 0, reward: 10, streak: 1 },
            feed5: { count: 0, nextAvailable: 0, reward: 25 },
            purchaseDaily: { nextAvailable: 0, reward: 20 },
            farmOnce: { completed: false, reward: 50 },
            dailyComplex: { 
                petCount: 0, 
                coinsCaught: 0, 
                farmGrown: false, 
                nextAvailable: 0, 
                reward: 70 
            }
        };
        function loadTasksState() {
            try {
                const raw = localStorage.getItem('tasksState');
                if (raw) {
                    const saved = JSON.parse(raw);
                    tasksState = { ...tasksState, ...saved };
                }
            } catch (e) {}
        }
        function saveTasksState() {
            try {
                localStorage.setItem('tasksState', JSON.stringify(tasksState));
            } catch (e) {}
        }
        function nowMs() { return Date.now(); }
        function timeLeft(ts) {
            const left = ts - nowMs();
            return left > 0 ? left : 0;
        }
        function formatTime(ms) {
            const s = Math.floor(ms / 1000);
            const h = Math.floor(s / 3600);
            const m = Math.floor((s % 3600) / 60);
            const sec = s % 60;
            return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
        }

        function updateBalanceUI() {
            document.querySelectorAll('.balance').forEach(el => {
                el.innerHTML = `–ë–∞–ª–∞–Ω—Å <br> ü™ô${coins}`;
            });
        }

        function goBack() {
            window.history.back();
        }

        if (babyCat) {
            babyCat.style.left = `${window.innerWidth / 2 - 120}px`;
            babyCat.style.top = `${window.innerHeight * 0.72}px`;
            babyCat.style.backgroundPosition = "0 0";
        }


        // –ü–æ—á–∞—Ç–∫–æ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è —á–æ—Ä–Ω–æ–≥–æ –∫–æ—Ç–∏–∫–∞ ‚Äî —Ç—Ä–æ—Ö–∏ –ø—Ä–∞–≤—ñ—à–µ
        if (blackCat) {
            const blackStartX = window.innerWidth / 2 + 40;
            const blackStartY = window.innerHeight * 0.7;
            blackCat.style.left = `${blackStartX}px`;
            blackCat.style.top = `${blackStartY}px`;
            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –∫–∞–¥—Ä —Å–ø—Ä–∞–π—Ç–∞
            blackCat.style.backgroundPosition = '0 0';
        }

        

        function setAnimation(row, frame = 0) {
            cat.style.backgroundPositionY = `-${row * 122}px`;
            cat.style.backgroundPositionX = `-${frame * 122}px`;
        }

        function walk() {
            if (isSitting || isLying || isClicked || isBlocked) return;
            frame = (frame + 1) % 4;
            cat.style.backgroundPositionX = `-${frame * 122}px`;
        }

        function moveCat() {
            if (isSitting || isLying || isClicked || isBlocked) return;

            let x = cat.offsetLeft;
            let y = cat.offsetTop;

            if (repeatMove) {
                direction = lastDirection;
                repeatMove = false;
            } else {
                direction = Math.floor(Math.random() * 4);
                if ((direction === 1 || direction === 3) && Math.random() < 0.4) {
                    repeatMove = true;
                    lastDirection = direction;
                }
            }

            const step = 15;
            switch (direction) {
                case 0:
                    y += step;
                    setAnimation(0);
                    break;
                case 1:
                    x += step;
                    setAnimation(1);
                    break;
                case 2:
                    y -= step;
                    setAnimation(2);
                    break;
                case 3:
                    x -= step;
                    setAnimation(3);
                    break;
            }

            const minY = window.innerHeight * 0.6;
            const maxY = window.innerHeight * 0.96 - 96;
            const minX = window.innerWidth * 0.01;
            const maxX = window.innerWidth * 0.96 - 96;

            x = Math.max(minX, Math.min(maxX, x));
            y = Math.max(minY, Math.min(maxY, y));

            let distanceFromBottom = window.innerHeight - y;
            if (distanceFromBottom > 250) {
                cat.style.transform = "scale(0.89)";
            } else if (distanceFromBottom > 210) {
                cat.style.transform = "scale(0.92)";
            } else if (distanceFromBottom > 170) {
                cat.style.transform = "scale(0.96)";
            } else {
                cat.style.transform = "scale(1)";
            }

            cat.style.transition = `top ${speed}s linear, left ${speed}s linear, transform ${speed}s linear`;
            cat.style.left = `${x}px`;
            cat.style.top = `${y}px`;
            // z-index: –¥–∏–Ω–∞–º—ñ—á–Ω–æ –≤—ñ–¥ –≤–∏—Å–æ—Ç–∏ (—á–∏–º –Ω–∏–∂—á–µ, —Ç–∏–º –≤–∏—â–µ —à–∞—Ä)
            cat.style.zIndex = Math.floor(cat.offsetTop);
        }

        function animateSitDown(callback) {
            let sitFrame = 0;
            let sitAnimation = setInterval(() => {
                setAnimation(4, sitFrame);
                sitFrame++;
                if (sitFrame >= 4) {
                    clearInterval(sitAnimation);
                    if (callback) setTimeout(callback, 500);
                }
            }, 300);
        }

        function animateLieDown(callback) {
            let lieFrame = 0;
            let lieAnimation = setInterval(() => {
                setAnimation(6, lieFrame);
                lieFrame++;
                if (lieFrame >= 4) {
                    clearInterval(lieAnimation);
                    if (callback) setTimeout(callback, 500);
                }
            }, 300);
        }

        function animateStandUp(callback) {
            let standFrame = 3;
            let standAnimation = setInterval(() => {
                setAnimation(4, standFrame);
                standFrame--;
                if (standFrame < 0) {
                    clearInterval(standAnimation);
                    isSitting = false;
                    setAnimation(0, 0);
                    if (callback) callback();
                }
            }, 300);
        }

        function animateStandUpFromLie(callback) {
            let standFrame = 3;
            let standAnimation = setInterval(() => {
                setAnimation(6, standFrame);
                standFrame--;
                if (standFrame < 0) {
                    clearInterval(standAnimation);
                    isLying = false;
                    setAnimation(0, 0);
                    if (callback) callback();
                }
            }, 300);
        }

        // === NEW ===

        let hungerStage = 0;
        let energyStage = 0;
        let isSleeping = false;
        let isAngry = false;
        let isBlocked = false;
        let emoteAnimationInterval = null;
        let currentBowl = null;

        // –ó–º—ñ–Ω–Ω–∞ –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ—ó –∫—É–ø–ª–µ–Ω–æ—ó –º–∏—Å–∫–∏
        let currentBowlId = 1;

        function updateBars() {
            document.getElementById('hungerBar').src = `images/hungry_${hungerStage}.png`;
            document.getElementById('energyBar').src = `images/energy_${energyStage}.png`;
        }

        const emote = document.getElementById('emote');

        function showEmote(type) {
            emote.className = 'emote';
            if (type === 'angry') {
                emote.textContent = 'üò°';
                emote.classList.add('angry');
            } else if (type === 'sleep') {
                emote.textContent = 'üí§';
                emote.classList.add('sleep');
            }
            positionEmote();
            emote.style.opacity = '1';
        }

        function hideEmote() {
            emote.style.opacity = '0';
            setTimeout(() => emote.className = 'emote', 600);
        }

        function positionEmote() {
            const catRect = cat.getBoundingClientRect();
            emote.style.left = `${cat.offsetLeft + 40}px`;
            emote.style.top = `${cat.offsetTop - 7}px`;
        }

        function startEmoteAnimation(type) {
            let currentFrame = 0;
            clearInterval(emoteAnimationInterval);
            showEmote(type);

            if (type === "angry") {
                emoteAnimationInterval = setInterval(() => {
                    setAnimation(7, currentFrame === 0 ? 2 : 3);
                    currentFrame = 1 - currentFrame;
                }, 700);
            } else if (type === "sleep") {
                emoteAnimationInterval = setInterval(() => {
                    setAnimation(7, currentFrame === 0 ? 0 : 1);
                    currentFrame = 1 - currentFrame;
                }, 1300);
            }
        }

        function stopCatActions() {
            clearTimeout(walkTimeout);
            clearTimeout(restTimeout);
            isClicked = false;
            isSitting = false;
            isLying = false;
            isBlocked = true; // –ë–ª–æ–∫—É—î–º–æ –¥—ñ—ó –∫–æ—Ç–∏–∫–∞
            clearInterval(emoteAnimationInterval); // –ó—É–ø–∏–Ω—è—î–º–æ –≤—Å—ñ –∞–Ω—ñ–º–∞—Ü—ñ—ó
        }

        // –ü–µ—Ä–µ—Ö—ñ–¥ —É –∑–ª—ñ—Å—Ç—å (—Ç–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—î –Ω–∞–≤—ñ—Ç—å –ø—ñ–¥ —á–∞—Å —Å–Ω—É)
        function transitionToAngry() {
            if (isAngry) return;

            console.log("–ü–æ—á–∞—Ç–æ–∫ transitionToAngry");
            isAngry = true;
            isBlocked = true; // –ë–ª–æ–∫—É—î–º–æ —ñ–Ω—à—ñ –¥—ñ—ó
            stopCatActions();
            isSitting = true;

            animateSitDown(() => {
                console.log("–ö—ñ—Ç —Å—ñ–≤, –ø–æ–∫–∞–∑—É—î–º–æ –∑–ª—ñ—Å—Ç—å");
                startEmoteAnimation("angry");
                startAngryAnimation();
            });
        }

        function completeAngryTransition() {
            isAngry = true;
            isBlocked = true;
            stopCatActions();
            isSitting = true;

            animateSitDown(() => {
                startEmoteAnimation("angry");
                startAngryAnimation();
            });
        }

        function startAngryAnimation() {
            let currentFrame = 2;
            clearInterval(emoteAnimationInterval);
            emoteAnimationInterval = setInterval(() => {
                setAnimation(7, currentFrame);
                currentFrame = currentFrame === 2 ? 3 : 2;
            }, 700);
        }

        function transitionToSleep() {
            if (isSleeping || isAngry || isBlocked || hungerStage === 5) {
                console.log("–ö–æ—Ç–∏–∫ –Ω–µ –º–æ–∂–µ —Å–ø–∞—Ç–∏: isSleeping?", isSleeping, "isAngry?", isAngry, "isBlocked?", isBlocked, "hungerStage", hungerStage);
                return;
            }

            isSleeping = true;
            isBlocked = true;
            stopCatActions();
            isLying = true;

            animateLieDown(() => {
                startEmoteAnimation("sleep");
                startSleepingAnimation();
            });
        }

        function startSleepingAnimation() {
            let currentFrame = 0;
            clearInterval(emoteAnimationInterval);
            emoteAnimationInterval = setInterval(() => {
                setAnimation(7, currentFrame);
                currentFrame = 1 - currentFrame;
            }, 1000);
        }

        function checkCatState() {
            console.log(`–°—Ç–∞–Ω: hunger=${hungerStage}, energy=${energyStage}, isSleeping=${isSleeping}, isAngry=${isAngry}, isBlocked=${isBlocked}`);

            // –ì–æ–ª–æ–¥ –º–∞—î –Ω–∞–π–≤–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç - –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –∫—ñ—Ç —Å–ø–∏—Ç—å/–∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π
            if (hungerStage === 5) {
                console.log("–ö–æ—Ç–∏–∫ –≥–æ–ª–æ–¥–Ω–∏–π (hungerStage=5)");
                if (isSleeping) {
                    console.log("–°–ø—Ä–æ–±–∞ –ø—Ä–æ–∫–∏–Ω—É—Ç–∏ —Å–ø–ª—è—á–æ–≥–æ –≥–æ–ª–æ–¥–Ω–æ–≥–æ –∫–æ—Ç–∞");
                    forceWakeUpAndAngry();
                } else if (!isAngry) {
                    console.log("–ü–µ—Ä–µ—Ö—ñ–¥ —É —Å—Ç–∞–Ω –∑–ª–æ—Å—Ç—ñ");
                    transitionToAngry();
                }
                return; // –ù–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —ñ–Ω—à—ñ —Å—Ç–∞–Ω–∏, —è–∫—â–æ –∫—ñ—Ç –≥–æ–ª–æ–¥–Ω–∏–π
            }

            // –Ø–∫—â–æ –Ω–µ –≥–æ–ª–æ–¥–Ω–∏–π, –∞–ª–µ –≤—Ç–æ–º–ª–µ–Ω–∏–π - –º–æ–∂–Ω–∞ —Å–ø–∞—Ç–∏
            if (energyStage === 5 && !isSleeping && !isBlocked) {
                console.log("–ö–æ—Ç–∏–∫ –≤—Ç–æ–º–ª–µ–Ω–∏–π - –ø–µ—Ä–µ—Ö—ñ–¥ —É —Å–æ–Ω");
                transitionToSleep();
            }
        }

        // –ü—Ä–∏–º—É—Å–æ–≤–æ –ø—Ä–æ–∫–∏–Ω—É—Ç–∏ –∫–æ—Ç–∞ —ñ –∑—Ä–æ–±–∏—Ç–∏ –π–æ–≥–æ –∑–ª–∏–º
        function forceWakeUpAndAngry() {
            console.log("–ü–æ—á–∞—Ç–æ–∫ forceWakeUpAndAngry");
            isSleeping = false;
            isBlocked = false; // –†–æ–∑–±–ª–æ–∫–æ–≤—É—î–º–æ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥—É –≤ –∑–ª—ñ—Å—Ç—å
            clearInterval(emoteAnimationInterval);
            hideEmote();

            // –®–≤–∏–¥–∫–æ –ø—Ä–æ–∫–∏–¥–∞—î–º–æ –∫–æ—Ç–∞
            animateStandUpFromLie(() => {
                console.log("–ö—ñ—Ç –ø—Ä–æ–∫–∏–Ω—É–≤—Å—è, —Ç–µ–ø–µ—Ä –ø–µ—Ä–µ—Ö—ñ–¥ —É –∑–ª—ñ—Å—Ç—å");
                transitionToAngry();
            });
        }

        function animateWakeUpFromSleep(callback) {
            let standFrame = 3;
            let animation = setInterval(() => {
                setAnimation(6, standFrame);
                standFrame--;
                if (standFrame < 0) {
                    clearInterval(animation);
                    if (callback) callback();
                }
            }, 300);
        }

        function animateCalmDown(callback) {
            let calmFrame = 3;
            let animation = setInterval(() => {
                setAnimation(4, calmFrame);
                calmFrame--;
                if (calmFrame < 0) {
                    clearInterval(animation);
                    if (callback) callback();
                }
            }, 300);
        }

        function finalizeWakeUp() {
            isClicked = false;
            isSitting = false;
            isLying = false;
            updateBars();
            setAnimation(0, 0);
            startWalkingCycle();
        }

        function resumeCatActions() {
            isBlocked = false;
            clearInterval(emoteAnimationInterval);
            hideEmote();

            if (isSleeping) {
                isSleeping = false;
                animateWakeUpFromSleep(() => {
                    // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –º–∞—Å—à—Ç–∞–± –ø—ñ—Å–ª—è –ø—Ä–æ–±—É–¥–∂–µ–Ω–Ω—è
                    updateCatScale();
                    finalizeWakeUp();
                });
            } else if (isAngry) {
                isAngry = false;
                animateCalmDown(() => {
                    // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –º–∞—Å—à—Ç–∞–± –ø—ñ—Å–ª—è –∑–ª–æ—Å—Ç—ñ
                    updateCatScale();
                    finalizeWakeUp();
                });
            } else {
                // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –º–∞—Å—à—Ç–∞–±
                updateCatScale();
                finalizeWakeUp();
            }
        }

        function updateCatScale() {
            const y = cat.offsetTop;
            const distanceFromBottom = window.innerHeight - y;

            if (distanceFromBottom > 250) {
                cat.style.transform = "scale(0.89)";
            } else if (distanceFromBottom > 210) {
                cat.style.transform = "scale(0.92)";
            } else if (distanceFromBottom > 170) {
                cat.style.transform = "scale(0.96)";
            } else {
                cat.style.transform = "scale(1)";
            }
        }

        function finalizeWakeUp() {
            isClicked = false;
            isSitting = false;
            isLying = false;
            updateBars();
            setAnimation(0, 0);
            startWalkingCycle();
        }


        function feedCat() {
            if (hungerStage > 0) hungerStage--;
            if (energyStage > 0) energyStage--;

            updateBars();

            if (hungerStage < 5 && energyStage < 5 && isBlocked) {
                resumeCatActions();
            }

            if (isAngry || isSleeping) {
                hideEmote();
                isAngry = false;
                isSleeping = false;
            }
        }

        function decreaseHunger() {
            if (hungerStage < 5) {
                hungerStage++;
                updateBars();
                saveGameState();
                checkCatState(); // –í–∏–∫–ª–∏–∫–∞—î–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —Å—Ç–∞–Ω—É –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏ –≥–æ–ª–æ–¥—É
            }
        }

        function decreaseEnergy() {
            if (energyStage < 5) {
                energyStage++;
                updateBars();
                saveGameState();
            }
            checkCatState();
        }


        function toggleSit() {
            if (isBlocked || isClicked) return;

            // –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É –ó–∞–≤–¥–∞–Ω–Ω—è –¥–Ω—è (–ø–æ–≥–ª–∞–¥–∂—É–≤–∞–Ω–Ω—è)
            if (timeLeft(tasksState.dailyLogin.nextAvailable) >= 0) { // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ dailyLogin —è–∫ –º–∞—Ä–∫–µ—Ä —â–æ–¥–µ–Ω–Ω–æ—Å—Ç—ñ –∞–±–æ –ø—Ä–æ—Å—Ç–æ –¥–æ–∑–≤–æ–ª—è—î–º–æ –∑–∞–≤–∂–¥–∏ –ø—Ä–æ–≥—Ä–µ—Å—É–≤–∞—Ç–∏ —è–∫—â–æ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                if (timeLeft(tasksState.dailyComplex.nextAvailable) === 0) {
                    tasksState.dailyComplex.petCount = (tasksState.dailyComplex.petCount || 0) + 1;
                    if (tasksState.dailyComplex.petCount > 10) tasksState.dailyComplex.petCount = 10;
                    checkDailyComplexTask();
                    saveTasksState();
                }
            }

            isClicked = true;
            clearTimeout(walkTimeout);
            clearTimeout(restTimeout);

            if (isSitting || isLying) {
                if (isLying) {
                    animateStandUpFromLie(() => {
                        isSitting = false;
                        isLying = false;
                        isClicked = false;
                        startWalkingCycle();
                    });
                } else {
                    animateStandUp(() => {
                        isSitting = false;
                        isLying = false;
                        isClicked = false;
                        startWalkingCycle();
                    });
                }
            } else {
                isSitting = true;
                animateSitDown(() => {
                    setTimeout(() => {
                        isClicked = false;
                    }, 1000);
                });
            }
        }

        function startWalkingCycle() {
            if (isClicked || isSitting || isLying || isBlocked) return;

            let walkTime = Math.floor(Math.random() * (120000 - 90000) + 90000);
            walkTimeout = setTimeout(() => {
                let restType = Math.random() < 0.61 ? 'sit' : 'lie';
                let restTime;

                if (restType === 'sit') {
                    restTime = Math.floor(Math.random() * (30000 - 15000) + 15000);
                    isSitting = true;
                    animateSitDown(() => {
                        restTimeout = setTimeout(() => {
                            animateStandUp(() => {
                                isSitting = false;
                                startWalkingCycle();
                            });
                        }, restTime);
                    });
                } else {
                    restTime = Math.floor(Math.random() * (45000 - 30000) + 30000);
                    isLying = true;
                    animateLieDown(() => {
                        restTimeout = setTimeout(() => {
                            animateStandUpFromLie(() => {
                                isLying = false;
                                startWalkingCycle();
                            });
                        }, restTime);
                    });
                }
            }, walkTime);
        }

        cat.addEventListener('click', toggleSit);
        setInterval(walk, 300);
        setInterval(moveCat, 1500);
        setInterval(decreaseHunger, 60 * 60 * 1000);
        setInterval(decreaseEnergy, 2 * 60 * 60 * 1000);

        updateBars();
        startWalkingCycle();

        // === –õ–æ–≥—ñ–∫–∞ –¥–ª—è –∫–æ—Ç–∏–∫–∞ –±–µ–π–±—ñ ===
        if (babyCat) {
            let babyFrame = 0;
            let babyDirection = 0;
            let babyLastDirection = -1;
            let babyRepeatMove = false;
            let babyState = "walk"; // walk | sit | eat
            let babySitTimeout = null;
            let babyLieTimeout = null;
            let babyEatTimeout = null;
            let babyIsAnimating = false;
            let babyActionCooldown = false;
            let babyZoomInterval = null; // –Ü–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è "Zoomies" (–±—ñ–≥–∞–Ω–∏–Ω–∏)
            let babyIsZooming = false;   // –ß–∏ –±—ñ–≥–∞—î –∑–∞—Ä–∞–∑
            let babyMoveInterval = null; // –ó–º—ñ–Ω–Ω–∞ –¥–ª—è —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É —Ä—É—Ö—É
            let babyWalkInterval = null; // –ó–º—ñ–Ω–Ω–∞ –¥–ª—è —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –∞–Ω—ñ–º–∞—Ü—ñ—ó —Ö–æ–¥—å–±–∏

            // –ö–∞—Ä—Ç–∞ —Ä—è–¥–∫—ñ–≤ —Å–ø—Ä–∞–π—Ç—É –¥–ª—è –±–µ–π–±—ñ: –Ω–∞–ª–∞—à—Ç—É–π—Ç–µ –ø—ñ–¥ –≤–∞—à PNG.
            // –ù–∞–ø—Ä—è–º–∫–∏: 0=–≤–Ω–∏–∑, 1=–≤–ø—Ä–∞–≤–æ, 2=–≤–≥–æ—Ä—É, 3=–≤–ª—ñ–≤–æ
            const BABY_DIR_ROW = [0, 1, 2, 3];
            // –†—è–¥–∏ –¥—ñ–π:
            const BABY_SIT_ROW = 4;
            const BABY_LIE_ROW = 6;
            const BABY_EAT_ROW = 5; // —è–∫—â–æ —ó–∂–∞ –Ω–∞ —ñ–Ω—à–æ–º—É —Ä—è–¥—É ‚Äî –∑–º—ñ–Ω—ñ—Ç—å —Ç—É—Ç
            function startBabyActionCooldown() {
                babyActionCooldown = true;
                setTimeout(() => {
                    babyActionCooldown = false;
                }, 30000 + Math.random() * 15000);
            }
            function setBabyAnimation(row, frame = 0) {
                const frameWidth = 122;
                const frameHeight = 122;
                babyCat.style.backgroundPositionY = `-${row * frameHeight}px`;
                babyCat.style.backgroundPositionX = `-${frame * frameWidth}px`;
            }
            function walkBaby() {
                if (babyState !== "walk") return;
                babyFrame = (babyFrame + 1) % 4;
                const row = BABY_DIR_ROW[babyDirection] ?? 0;
                setBabyAnimation(row, babyFrame);
            }
            function moveBabyCat() {
                // –ë–∞—Ä'—î—Ä –¥–ª—è –±–µ–π–±—ñ ‚Äî —è–∫ —É —á–æ—Ä–Ω–æ–≥–æ –∫–æ—Ç–∞
                const minY = window.innerHeight * 0.55;
                const maxY = window.innerHeight * 0.98 - 122;
                const minX = window.innerWidth * 0.0;
                const maxX = window.innerWidth * 0.98 - 122;
                if (babyState !== "walk") return;
                // --- —Ä—É—Ö ---
                if (babyRepeatMove) {
                    if (Math.random() < 0.6) {
                        babyDirection = babyLastDirection;
                        babyRepeatMove = true;
                    } else if (Math.random() < 0.75) {
                        babyDirection = (babyLastDirection + (Math.random() < 0.5 ? 1 : 3)) % 4;
                        babyRepeatMove = false;
                        babyLastDirection = babyDirection;
                    } else {
                        babyDirection = (babyLastDirection + 2) % 4;
                        babyRepeatMove = false;
                        babyLastDirection = babyDirection;
                    }
                } else {
                    if (Math.random() < 0.1) return;
                    babyDirection = Math.floor(Math.random() * 4);
                    if (Math.random() < 0.6) {
                        babyRepeatMove = true;
                        babyLastDirection = babyDirection;
                    } else {
                        babyRepeatMove = false;
                        babyLastDirection = babyDirection;
                    }
                }
                let x = babyCat.offsetLeft;
                let y = babyCat.offsetTop;
                const step = babyIsZooming ? 16 : 12; // –Ø–∫—â–æ –±—ñ–≥–∞—î ‚Äî –∫—Ä–æ–∫ –±—ñ–ª—å—à–∏–π (16px)
                switch (babyDirection) {
                    case 0: y += step; break;
                    case 1: x += step; break;
                    case 2: y -= step; break;
                    case 3: x -= step; break;
                }
                x = Math.max(minX, Math.min(maxX, x));
                y = Math.max(minY, Math.min(maxY, y));
                let distanceFromBottom = window.innerHeight - y;
                // –ó–º–µ–Ω—à–µ–Ω–∏–π –º–∞—Å—à—Ç–∞–± –¥–ª—è –±–µ–π–±—ñ (–±–∞–∑–∞ ~0.85)
                if (distanceFromBottom > 250) {
                    babyCat.style.transform = "scale(0.73)";
                } else if (distanceFromBottom > 210) {
                    babyCat.style.transform = "scale(0.75)";
                } else if (distanceFromBottom > 170) {
                    babyCat.style.transform = "scale(0.78)";
                } else {
                    babyCat.style.transform = "scale(0.81)";
                }
                babyCat.style.left = `${x}px`;
                babyCat.style.top = `${y}px`;
                // z-index: –¥–∏–Ω–∞–º—ñ—á–Ω–æ –≤—ñ–¥ –≤–∏—Å–æ—Ç–∏
                babyCat.style.zIndex = Math.floor(babyCat.offsetTop);
                if (babyHearts && babyHearts.style.display !== 'none' && babyState === 'sit') {
                    babyHearts.style.left = `${babyCat.offsetLeft + babyCat.offsetWidth / 2}px`;
                    babyHearts.style.top = `${babyCat.offsetTop}px`;
                }
            }
            // --- –°–∏–¥—ñ–Ω–Ω—è ---
            function animateBabySitDown() {
                if (babySitTimeout) clearTimeout(babySitTimeout);
                if (babyIsAnimating) return;
                babyIsAnimating = true;
                const prevTransition = babyCat.style.transition;
                babyCat.style.transition = 'transform 0.5s linear';
                // –í–ê–ñ–õ–ò–í–û: –æ–¥—Ä–∞–∑—É –ø–µ—Ä–µ–≤–æ–¥–∏–º–æ —É —Å—Ç–∞–Ω "sit", —â–æ–± walkBaby –Ω–µ –≤—Ç—Ä—É—á–∞–≤—Å—è
                babyState = "sit";
                if (babyHearts) {
                    babyHearts.style.display = 'block';
                    babyHearts.style.left = `${babyCat.offsetLeft + babyCat.offsetWidth / 2}px`;
                    babyHearts.style.top = `${babyCat.offsetTop}px`;
                }
                let sitFrame = 0;
                let sitAnim = setInterval(() => {
                    setBabyAnimation(BABY_SIT_ROW, sitFrame);
                    sitFrame++;
                    if (sitFrame >= 4) {
                        clearInterval(sitAnim);
                        babyIsAnimating = false;
                        babyCat.style.transition = prevTransition;
                        const standDelay = 5000 + Math.random() * 5000;
                        setTimeout(() => {
                            animateBabyStandUpFromSit();
                        }, standDelay);
                    }
                }, 300);
            }
            function animateBabyStandUpFromSit() {
                if (babyIsAnimating) return;
                babyIsAnimating = true;
                let standFrame = 3;
                let standAnim = setInterval(() => {
                    setBabyAnimation(BABY_SIT_ROW, standFrame);
                    standFrame--;
                    if (standFrame < 0) {
                        clearInterval(standAnim);
                        babyIsAnimating = false;
                        babyState = "walk";
                        startBabyActionCooldown();
                        if (babyHearts) {
                            babyHearts.style.display = 'none';
                        }
                    }
                }, 300);
            }
            function scheduleBabySit() {
                const delay = 30000 + Math.random() * 15000;
                if (babySitTimeout) clearTimeout(babySitTimeout);
                babySitTimeout = setTimeout(() => {
                    if (babyState === "walk" && !babyActionCooldown) animateBabySitDown();
                    scheduleBabySit();
                }, delay);
            }
            // --- –õ–µ–∂–∏—Ç—å ---
            function animateBabyLieDown() {
                if (babyIsAnimating) return;
                babyIsAnimating = true;
                const prevTransition = babyCat.style.transition;
                babyCat.style.transition = 'transform 0.5s linear';
                let lieFrame = 0;
                babyState = "lie";
                if (babyLieTimeout) clearTimeout(babyLieTimeout);
                let lieAnim = setInterval(() => {
                    setBabyAnimation(BABY_LIE_ROW, lieFrame);
                    lieFrame++;
                    if (lieFrame >= 4) {
                        clearInterval(lieAnim);
                        babyIsAnimating = false;
                        babyCat.style.transition = prevTransition;
                        scheduleBabyStandUpFromLie();
                    }
                }, 300);
            }
            function scheduleBabyLie() {
                const delay = 30000 + Math.random() * 15000;
                babyLieTimeout = setTimeout(() => {
                    if (babyState === "walk" && !babyActionCooldown) animateBabyLieDown();
                    scheduleBabyLie();
                }, delay);
            }
            function animateBabyStandUpFromLie() {
                if (babyIsAnimating) return;
                babyIsAnimating = true;
                let standFrame = 3;
                let standAnim = setInterval(() => {
                    setBabyAnimation(BABY_LIE_ROW, standFrame);
                    standFrame--;
                    if (standFrame < 0) {
                        clearInterval(standAnim);
                        babyState = "walk";
                        babyIsAnimating = false;
                        startBabyActionCooldown();
                    }
                }, 300);
            }
            function scheduleBabyStandUpFromLie() {
                const delay = 15000 + Math.random() * 10000;
                babyLieTimeout = setTimeout(() => {
                    if (babyState === "lie" && !babyIsAnimating) {
                        animateBabyStandUpFromLie();
                    }
                }, delay);
            }
            // --- –á—Å—Ç—å ---
            function animateBabyEat() {
                if (babyIsAnimating) return;
                babyIsAnimating = true;
                const prevTransition = babyCat.style.transition;
                // –©–æ–± –∫–∞–¥—Ä–∏ –Ω–µ ‚Äú—Ç—è–≥–∞–ª–∏—Å—å‚Äù, –≤–∏–º–∏–∫–∞—î–º–æ –ø–ª–∞–≤–Ω–∏–π —Ä—É—Ö top/left –ø—ñ–¥ —á–∞—Å —ó–∂—ñ
                babyCat.style.transition = 'transform 0.5s linear';
                let eatFrame = 0;
                let eatCount = 0;
                babyState = "eat";
                let eatAnim = setInterval(() => {
                    setBabyAnimation(BABY_EAT_ROW, eatFrame);
                    eatFrame = (eatFrame + 1) % 4;
                    eatCount++;
                    if (eatCount > 12) {
                        clearInterval(eatAnim);
                        babyIsAnimating = false;
                        babyState = "walk";
                        babyCat.style.transition = prevTransition;
                        startBabyActionCooldown();
                    }
                }, 300);
            }
            function scheduleBabyEat() {
                const delay = 30000 + Math.random() * 15000;
                babyEatTimeout = setTimeout(() => {
                    if (babyState === "walk" && !babyActionCooldown) animateBabyEat();
                    scheduleBabyEat();
                }, delay);
            }

            // --- "Zoomies" (–±—ñ–≥–∞–Ω–∏–Ω–∞) ---
            function startBabyZoomies() {
                if (babyState !== "walk" || babyIsAnimating) {
                    // –Ø–∫—â–æ –∑–∞–π–Ω—è—Ç–∏–π, —Å–ø—Ä–æ–±—É—î–º–æ –ø—ñ–∑–Ω—ñ—à–µ
                    setTimeout(startBabyZoomies, 5000);
                    return;
                }
                
                babyIsZooming = true;
                
                // –ü—Ä–∏—Å–∫–æ—Ä—é—î–º–æ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏
                clearInterval(babyMoveInterval);
                clearInterval(babyWalkInterval);
                
                // –®–≤–∏–¥—à–∏–π —Ä—É—Ö (–∫–æ–∂–Ω—ñ 250–º—Å –∑–∞–º—ñ—Å—Ç—å 750–º—Å)
                babyMoveInterval = setInterval(moveBabyCat, 250);
                // –®–≤–∏–¥—à–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è (–∫–æ–∂–Ω—ñ 150–º—Å –∑–∞–º—ñ—Å—Ç—å 300–º—Å)
                babyWalkInterval = setInterval(walkBaby, 150);
                
                // –ó–º—ñ–Ω—é—î–º–æ transition –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç—ñ —à–≤–∏–¥–∫–æ–≥–æ —Ä—É—Ö—É
                babyCat.style.transition = 'transform 0.25s linear, left 0.25s linear, top 0.25s linear';
                
                // –ë—ñ–≥–∞—î 7 —Å–µ–∫—É–Ω–¥
                setTimeout(endBabyZoomies, 7000);
            }

            function endBabyZoomies() {
                babyIsZooming = false;
                
                // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–≤–∏—á–∞–π–Ω—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏
                clearInterval(babyMoveInterval);
                clearInterval(babyWalkInterval);
                
                babyMoveInterval = setInterval(moveBabyCat, 750);
                babyWalkInterval = setInterval(walkBaby, 300);
                
                // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–≤–∏—á–∞–π–Ω–∏–π transition
                babyCat.style.transition = 'transform 0.5s linear, left 0.5s linear, top 0.5s linear';
                
                scheduleBabyZoomies();
            }

            function scheduleBabyZoomies() {
                // –í–∏–ø–∞–¥–∫–æ–≤–∏–π —á–∞—Å –≤—ñ–¥ 100 –¥–æ 150 —Å–µ–∫—É–Ω–¥ (100000 - 150000 –º—Å)
                const delay = Math.floor(Math.random() * (150000 - 100000) + 100000);
                // const delay = 5000; // –î–ª—è —Ç–µ—Å—Ç—É –º–æ–∂–Ω–∞ —Ä–æ–∑–∫–æ–º–µ–Ω—Ç—É–≤–∞—Ç–∏
                setTimeout(startBabyZoomies, delay);
            }

            // --- –ó–∞–ø—É—Å–∫ ---
            setBabyAnimation(0, 0);
            babyMoveInterval = setInterval(moveBabyCat, 750);
            babyWalkInterval = setInterval(walkBaby, 300);
            scheduleBabySit();
            // –õ–µ–∂–∞–Ω–Ω—è –≤–∏–º–∫–Ω–µ–Ω–æ –¥–ª—è –±–µ–π–±—ñ –∑–∞ –≤–∏–º–æ–≥–æ—é ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —Å–∏–¥—ñ–Ω–Ω—è —Ç–∞ —ó–∂—É
            scheduleBabyEat();
            scheduleBabyZoomies(); // –ó–∞–ø—É—Å–∫–∞—î–º–æ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –±—ñ–≥–∞–Ω–∏–Ω–∏
        }


        
        // === –õ–æ–≥—ñ–∫–∞ –¥–ª—è —á–æ—Ä–Ω–æ–≥–æ –∫–æ—Ç–∏–∫–∞ ===
        if (blackCat) {
            let blackFrame = 0;
            let blackDirection = 0;
            let blackLastDirection = -1;
            let blackRepeatMove = false;
            let blackState = "walk"; // walk | sit | lie | eat
            let blackSitTimeout = null;
            let blackLieTimeout = null;
            let blackEatTimeout = null;
            let blackIsAnimating = false;

            // --- –ö—É–ª–¥–∞—É–Ω –º—ñ–∂ –¥—ñ—è–º–∏ ---
            let blackActionCooldown = false;
            function startBlackActionCooldown() {
                blackActionCooldown = true;
                setTimeout(() => {
                    blackActionCooldown = false;
                }, 30000 + Math.random() * 15000); // 30-45 —Å–µ–∫
            }

            function setBlackAnimation(row, frame = 0) {
                const frameWidth = 122;
                const frameHeight = 122;
                blackCat.style.backgroundPositionY = `-${row * frameHeight}px`;
                blackCat.style.backgroundPositionX = `-${frame * frameWidth}px`;
            }

            function walkBlack() {
                if (blackState !== "walk") return;
                blackFrame = (blackFrame + 1) % 4;
                // –í–∏–∑–Ω–∞—á–∞—î–º–æ —Ä—è–¥ –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó –∑–≥—ñ–¥–Ω–æ –Ω–∞–ø—Ä—è–º–∫—É
                let row = 0;
                switch (blackDirection) {
                    case 0: row = 0; break; // –≤–Ω–∏–∑
                    case 1: row = 1; break; // –≤–ø—Ä–∞–≤–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ä—è–¥)
                    case 2: row = 2; break; // –≤–≥–æ—Ä—É
                    case 3: row = 3; break; // –≤–ª—ñ–≤–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ä—è–¥)
                }
                setBlackAnimation(row, blackFrame);
            }

            function moveBlackCat() {
                if (blackState !== "walk") return;
                let x = blackCat.offsetLeft;
                let y = blackCat.offsetTop;

                // 60% —à–∞–Ω—Å –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ —Ä—É—Ö —É —Ç–æ–º—É –∂ –Ω–∞–ø—Ä—è–º–∫—É, 30% ‚Äî –∑–º—ñ–Ω–∏—Ç–∏ –Ω–∞ —Å—É—Å—ñ–¥–Ω—ñ–π, 10% ‚Äî —Ä—ñ–∑–∫–æ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏
                if (blackRepeatMove) {
                    // 60% —à–∞–Ω—Å —â–µ —Ä–∞–∑ –ø–æ–≤—Ç–æ—Ä–∏—Ç–∏ —Ü–µ–π –Ω–∞–ø—Ä—è–º–æ–∫
                    if (Math.random() < 0.6) {
                        blackDirection = blackLastDirection;
                        blackRepeatMove = true;
                    } else if (Math.random() < 0.75) {
                        // 30% ‚Äî –ø–ª–∞–≤–Ω–æ –∑–º—ñ–Ω–∏—Ç–∏ –Ω–∞–ø—Ä—è–º–æ–∫ (—Å—É—Å—ñ–¥–Ω—ñ–π)
                        blackDirection = (blackLastDirection + (Math.random() < 0.5 ? 1 : 3)) % 4;
                        blackRepeatMove = false;
                        blackLastDirection = blackDirection;
                    } else {
                        // 10% ‚Äî —Ä—ñ–∑–∫–æ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ (–Ω–∞ –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–∏–π)
                        blackDirection = (blackLastDirection + 2) % 4;
                        blackRepeatMove = false;
                        blackLastDirection = blackDirection;
                    }
                } else {
                    // 10% —à–∞–Ω—Å –ø—Ä–æ—Å—Ç–æ –ø–æ—Å—Ç–æ—è—Ç–∏ (–Ω–µ —Ä—É—Ö–∞—Ç–∏—Å—å)
                    if (Math.random() < 0.1) {
                        return;
                    }
                    blackDirection = Math.floor(Math.random() * 4);
                    // 60% —à–∞–Ω—Å –ø–æ–≤—Ç–æ—Ä–∏—Ç–∏ —Ü–µ–π –Ω–∞–ø—Ä—è–º–æ–∫ —â–µ —Ä–∞–∑
                    if (Math.random() < 0.6) {
                        blackRepeatMove = true;
                        blackLastDirection = blackDirection;
                    } else {
                        blackRepeatMove = false;
                        blackLastDirection = blackDirection;
                    }
                }

                const step = 13; // —à–≤–∏–¥—à–µ —Ä—É—Ö–∞—î—Ç—å—Å—è
                switch (blackDirection) {
                    case 0: y += step; break;
                    case 1: x += step; break;
                    case 2: y -= step; break;
                    case 3: x -= step; break;
                }

                // –ë–∞—Ä'—î—Ä –¥–ª—è —á–æ—Ä–Ω–æ–≥–æ –∫–æ—Ç–∏–∫–∞ ‚Äî –º–æ–∂–Ω–∞ —Å–ø—É—Å–∫–∞—Ç–∏—Å—å –Ω–∏–∂—á–µ —ñ –ª—ñ–≤—ñ—à–µ
                const minY = window.innerHeight * 0.55;
                const maxY = window.innerHeight * 0.98 - 122;
                const minX = window.innerWidth * 0.0;
                const maxX = window.innerWidth * 0.98 - 122;

                x = Math.max(minX, Math.min(maxX, x));
                y = Math.max(minY, Math.min(maxY, y));

                let distanceFromBottom = window.innerHeight - y;
                if (distanceFromBottom > 250) {
                    blackCat.style.transform = "scale(0.89)";
                } else if (distanceFromBottom > 210) {
                    blackCat.style.transform = "scale(0.92)";
                } else if (distanceFromBottom > 170) {
                    blackCat.style.transform = "scale(0.96)";
                } else {
                    blackCat.style.transform = "scale(1)";
                }

                blackCat.style.transition = `top ${speed}s linear, left ${speed}s linear, transform ${speed}s linear`;
                blackCat.style.left = `${x}px`;
                blackCat.style.top = `${y}px`;
                // z-index: –¥–∏–Ω–∞–º—ñ—á–Ω–æ –≤—ñ–¥ –≤–∏—Å–æ—Ç–∏
                blackCat.style.zIndex = Math.floor(blackCat.offsetTop);
            }

            // --- –°–∏–¥—ñ–Ω–Ω—è ---
            function animateBlackSitDown() {
                if (blackSitTimeout) clearTimeout(blackSitTimeout);
                if (blackIsAnimating) return;
                blackIsAnimating = true;
                // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π transition
                const prevTransition = blackCat.style.transition;
                // –í–∏–º–∏–∫–∞—î–º–æ transition –¥–ª—è top/left
                blackCat.style.transition = 'transform 0.5s linear';
                let sitFrame = 0;
                let sitAnim = setInterval(() => {
                    setBlackAnimation(4, sitFrame);
                    sitFrame++;
                    if (sitFrame >= 4) {
                        clearInterval(sitAnim);
                        blackIsAnimating = false;
                        blackState = "sit";
                        // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ transition –Ω–∞–∑–∞–¥
                        blackCat.style.transition = prevTransition;
                        // –ß–µ—Ä–µ–∑ 5-10 —Å–µ–∫—É–Ω–¥ –∑–∞–ø—É—Å–∫–∞—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é –≤—Å—Ç–∞–≤–∞–Ω–Ω—è
                        const standDelay = 5000 + Math.random() * 5000;
                        setTimeout(() => {
                            animateBlackStandUpFromSit();
                        }, standDelay);
                    }
                }, 300);

            // –ê–Ω—ñ–º–∞—Ü—ñ—è –≤—Å—Ç–∞–≤–∞–Ω–Ω—è –ø—ñ—Å–ª—è —Å–∏–¥—ñ–Ω–Ω—è (–∑–≤–æ—Ä–æ—Ç–Ω–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è)
            function animateBlackStandUpFromSit() {
                if (blackIsAnimating) return;
                blackIsAnimating = true;
                let standFrame = 3;
                let standAnim = setInterval(() => {
                    setBlackAnimation(4, standFrame);
                    standFrame--;
                    if (standFrame < 0) {
                        clearInterval(standAnim);
                        blackIsAnimating = false;
                        blackState = "walk";
                        startBlackActionCooldown();
                    }
                }, 300);
            }
            }
            function scheduleBlackSit() {
                // –•–æ–¥–∏—Ç—å 30-45 —Å–µ–∫ –ø–µ—Ä–µ–¥ —Å–∏–¥—ñ–Ω–Ω—è–º
                const delay = 30000 + Math.random() * 15000;
                if (blackSitTimeout) clearTimeout(blackSitTimeout);
                blackSitTimeout = setTimeout(() => {
                    if (blackState === "walk" && !blackActionCooldown) animateBlackSitDown();
                    scheduleBlackSit();
                }, delay);
            }
            function animateBlackStandUp() {
                if (blackIsAnimating) return;
                blackIsAnimating = true;
                let standFrame = 3;
                let standAnim = setInterval(() => {
                    setBlackAnimation(4, standFrame);
                    standFrame--;
                    if (standFrame < 0) {
                        clearInterval(standAnim);
                        blackState = "walk";
                        blackIsAnimating = false;
                    }
                }, 300);
            }
            function animateBlackStandUpFromLie() {
                if (blackIsAnimating) return;
                blackIsAnimating = true;
                let standFrame = 3;
                let standAnim = setInterval(() => {
                    setBlackAnimation(6, standFrame);
                    standFrame--;
                    if (standFrame < 0) {
                        clearInterval(standAnim);
                        blackState = "walk";
                        blackIsAnimating = false;
                        startBlackActionCooldown();
                    }
                }, 300);
            }
            function animateBlackLieDown() {
                if (blackIsAnimating) return;
                blackIsAnimating = true;
                let lieFrame = 0;
                blackState = "lie";
                if (blackLieTimeout) clearTimeout(blackLieTimeout);
                let lieAnim = setInterval(() => {
                    setBlackAnimation(6, lieFrame);
                    lieFrame++;
                    if (lieFrame >= 4) {
                        clearInterval(lieAnim);
                        blackIsAnimating = false;
                        scheduleBlackStandUpFromLie();
                    }
                }, 300);
            // --- Stand up after sitting ---
            function scheduleBlackStandUp() {
                // scheduleBlackStandUp –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞, –±–æ –≤—Å—Ç–∞–≤–∞–Ω–Ω—è —Ç–µ–ø–µ—Ä —É animateBlackSitDown
            }

            // --- Stand up after lying ---
            function scheduleBlackStandUpFromLie() {
                // –ü—Ä–∏—Ä–æ–¥–Ω—ñ—à–µ: 15-25 —Å–µ–∫
                const delay = 15000 + Math.random() * 10000;
                blackLieTimeout = setTimeout(() => {
                    if (blackState === "lie" && !blackIsAnimating) {
                        animateBlackStandUpFromLie();
                    }
                }, delay);
            }
            }
            function scheduleBlackLie() {
                // –•–æ–¥–∏—Ç—å 30-45 —Å–µ–∫ –ø–µ—Ä–µ–¥ –ª–µ–∂–∞–Ω–Ω—è–º
                const delay = 30000 + Math.random() * 15000;
                blackLieTimeout = setTimeout(() => {
                    if (blackState === "walk" && !blackActionCooldown) animateBlackLieDown();
                    scheduleBlackLie();
                }, delay);
            }

            // --- –á—Å—Ç—å ---
            function animateBlackEat() {
                if (blackIsAnimating) return;
                blackIsAnimating = true;
                let eatFrame = 0;
                let eatCount = 0;
                blackState = "eat";
                let eatAnim = setInterval(() => {
                    setBlackAnimation(5, eatFrame);
                    eatFrame = (eatFrame + 1) % 4;
                    eatCount++;
                    if (eatCount > 12) { // ~3 —Å–µ–∫
                        clearInterval(eatAnim);
                        blackIsAnimating = false;
                        blackState = "walk";
                        startBlackActionCooldown();
                    }
                }, 300);
            }
            function scheduleBlackEat() {
                // –•–æ–¥–∏—Ç–∏ 30-45 —Å–µ–∫ –ø–µ—Ä–µ–¥ —ó–∂–µ—é
                const delay = 30000 + Math.random() * 15000;
                blackEatTimeout = setTimeout(() => {
                    if (blackState === "walk" && !blackActionCooldown) animateBlackEat();
                    scheduleBlackEat();
                }, delay);
            }

            // --- –ó–∞–ø—É—Å–∫ ---
            setBlackAnimation(0, 0);
            setInterval(moveBlackCat, 750); // —à–≤–∏–¥—à–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ—ó
            setInterval(walkBlack, 300);
            scheduleBlackSit();
            scheduleBlackLie();
            scheduleBlackEat();
        }

        // const bowl = document.getElementById('bowl');
        let isEating = false;

        function getBowlPosition() {
            const rect = bowl.getBoundingClientRect();
            console.log('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –º–∏—Å–∫–∏:', rect); // –î–æ–¥–∞–Ω–æ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
            return {
                x: rect.left + window.scrollX,
                y: rect.top + window.scrollY
            };
        }

        function moveCatTo(targetX, targetY, callback) {
            const step = 20;
            let frame = 0;

            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –º–∞—Å—à—Ç–∞–±
            const initialScale = cat.style.transform || 'scale(1)';

            function moveInX() {
                const intervalX = setInterval(() => {
                    let x = cat.offsetLeft;
                    if (Math.abs(targetX - x) <= step) {
                        clearInterval(intervalX);
                        moveInY();
                        return;
                    }

                    if (targetX > x) {
                        x += step;
                        setAnimation(1, frame);
                    } else {
                        x -= step;
                        setAnimation(3, frame);
                    }

                    cat.style.left = `${x}px`;
                    frame = (frame + 1) % 4;

                    // –û–Ω–æ–≤–ª—é—î–º–æ –º–∞—Å—à—Ç–∞–± –ø—ñ–¥ —á–∞—Å —Ä—É—Ö—É
                    updateScaleDuringMovement();
                }, 200);
            }

            function moveInY() {
                const intervalY = setInterval(() => {
                    let y = cat.offsetTop;
                    if (Math.abs(targetY - y) <= step) {
                        clearInterval(intervalY);
                        if (callback) callback();
                        return;
                    }

                    if (targetY > y) {
                        y += step;
                        setAnimation(0, frame);
                    } else {
                        y -= step;
                        setAnimation(2, frame);
                    }

                    cat.style.top = `${y}px`;
                    frame = (frame + 1) % 4;

                    // –û–Ω–æ–≤–ª—é—î–º–æ –º–∞—Å—à—Ç–∞–± –ø—ñ–¥ —á–∞—Å —Ä—É—Ö—É
                    updateScaleDuringMovement();
                }, 200);
            }

            function updateScaleDuringMovement() {
                const y = cat.offsetTop;
                const distanceFromBottom = window.innerHeight - y;

                if (distanceFromBottom > 250) {
                    cat.style.transform = "scale(0.89)";
                } else if (distanceFromBottom > 210) {
                    cat.style.transform = "scale(0.92)";
                } else if (distanceFromBottom > 170) {
                    cat.style.transform = "scale(0.96)";
                } else {
                    cat.style.transform = "scale(1)";
                }
            }

            moveInX();
        }

        function animateEating(callback) {
            console.log('–ö–æ—Ç–∏–∫ –ø–æ—á–∏–Ω–∞—î —ó—Å—Ç–∏');
            let eatFrame = 0;
            let eatCount = 0;
            const maxEats = 4;
            const interval = setInterval(() => {
                setAnimation(5, eatFrame);
                eatFrame = (eatFrame + 1) % 4;
                if (++eatCount > maxEats * 4) {
                    clearInterval(interval);
                    if (callback) callback();
                }
            }, 200);
        }

        function feedCatSequence(hungerGain = 1, energyGain = 1, callback) {
            console.log('–ö–æ—Ç–∏–∫ –ø–æ—á–∏–Ω–∞—î –π—Ç–∏ –¥–æ –º–∏—Å–∫–∏');
            isEating = true;
            stopCatActions();

            const bowlPos = getBowlPosition();
            const targetX = bowlPos.x - 30;
            const targetY = bowlPos.y - 30;

            // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –º–∞—Å—à—Ç–∞–± –ø–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º —Ä—É—Ö—É
            updateCatScale();

            moveCatTo(targetX, targetY, () => {
                console.log('–ö–æ—Ç–∏–∫ –¥—ñ–π—à–æ–≤ –¥–æ –º–∏—Å–∫–∏');
                animateEating(() => {
                    console.log('–ö–æ—Ç–∏–∫ –∑–∞–∫—ñ–Ω—á–∏–≤ —ó—Å—Ç–∏');
                    hungerStage = Math.max(0, hungerStage - hungerGain);
                    energyStage = Math.max(0, energyStage - energyGain);
                    updateBars();
                    isEating = false;

                    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –º–∞—Å—à—Ç–∞–± –ø—ñ—Å–ª—è –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è —ó–∂—ñ
                    updateCatScale();
                    resumeCatActions();

                    // –í–∏–∫–ª–∏–∫–∞—î–º–æ callback, —è–∫—â–æ –≤—ñ–Ω —î
                    if (callback) callback();
                    // –†–µ—î—Å—Ç—Ä—É—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å –∑–∞–≤–¥–∞–Ω–Ω—è "–ü–æ–∫–æ—Ä–º–∏ –∫–æ—Ç–∏–∫–∞ 5 —Ä–∞–∑—ñ–≤"
                    registerFeedingForTask();
                });
            });
        }

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞–Ω –∫–æ–∂–Ω—ñ 2 —Å
        setInterval(checkCatState, 2000);



        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è –º–∞–≥–∞–∑–∏–Ω—É (–¥–æ–¥–∞–Ω–æ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è)
        function closeShop() {
            const shopOverlay = document.getElementById('shopOverlay');
            shopOverlay.style.opacity = '0';
            setTimeout(() => {
                shopOverlay.style.display = 'none';
            }, 300);
        }

        // –û–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–∞–≥–∞–∑–∏–Ω—É
        function openShop() {
            const shopOverlay = document.getElementById('shopOverlay');
            const categoriesContainer = document.getElementById('categoriesContainer');

            // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
            categoriesContainer.innerHTML = '';
            const categories = ['–ö–æ—Ä–º', '–ú–∏—Å–∫–∏', '–õ–∞–º–ø–∏', '–ö–∞—Ä—Ç–∏–Ω–∏', '–Ü–≥—Ä–∞—à–∫–∏', '–¢—É–º–±–æ—á–∫–∏', '–§–∞—Ä–º', '–¢–∞—î–º–Ω–∞'];
            categories.forEach((category, index) => {
                const catElement = document.createElement('div');
                let isLocked = false;
                if (category === '–§–∞—Ä–º' && !isTumbPurchased()) {
                    isLocked = true;
                    catElement.className = 'category locked';
                    catElement.innerHTML = '<span class="lock-icon">üîí</span><span class="farm-text">–§–∞—Ä–º</span><span class="lock-icon">üîí</span>';
                } else if (category === '–¢–∞—î–º–Ω–∞' && !isSecretUnlocked) {
                    isLocked = true;
                    catElement.className = 'category locked';
                    catElement.innerHTML = '<span class="lock-icon">üîí</span><span class="farm-text">–¢–∞—î–º–Ω–∞</span><span class="lock-icon">üîí</span>';
                } else {
                    catElement.className = 'category' + (index === 0 ? ' active' : '');
                    catElement.textContent = category;
                }
                catElement.onclick = function () {
                    if (isLocked) {
                        if (category === '–§–∞—Ä–º') {
                            openFarmLockModal();
                        } else if (category === '–¢–∞—î–º–Ω–∞') {
                            openSecretUnlockModal();
                        }
                        return;
                    }
                    document.querySelectorAll('.category').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    this.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                    loadCategoryItems(category);
                };
                categoriesContainer.appendChild(catElement);
            });

            // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –ø–µ—Ä—à—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é (—Ç—ñ–ª—å–∫–∏ 4 —Ç–æ–≤–∞—Ä–∏)
            loadCategoryItems(categories[0], 4);

            // –ü–æ–∫–∞–∑—É—î–º–æ –º–∞–≥–∞–∑–∏–Ω
            shopOverlay.style.display = 'flex';
            setTimeout(() => {
                shopOverlay.style.opacity = '1';
            }, 10);

            // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–≤–¥–∞–Ω—å
            document.getElementById('tasksButton').onclick = function (e) {
                e.stopPropagation();
                openTasks();
            };
        }

        function openSecretUnlockModal() {
            document.getElementById('secretUnlockPriceLabel').textContent = SECRET_UNLOCK_PRICE;
            const modal = document.getElementById('secretUnlockModal');
            modal.style.display = 'flex';
        }
        function closeSecretUnlockModal() {
            const modal = document.getElementById('secretUnlockModal');
            modal.style.display = 'none';
        }
        function tryUnlockSecret() {
            if (coins >= SECRET_UNLOCK_PRICE) {
                coins -= SECRET_UNLOCK_PRICE;
                isSecretUnlocked = true;
                updateBalanceUI();
                saveGameState();
                closeSecretUnlockModal();
                openShop();
            } else {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º–æ–Ω–µ—Ç –¥–ª—è —Ä–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è ¬´–¢–∞—î–º–Ω–∞¬ª.');
            }
        }

        function loadCategoryItems(category, count = 4) {
            const shopContent = document.getElementById('shopContent');
            shopContent.innerHTML = '';

            // –î–ª—è –¢–∞—î–º–Ω–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑–∞–≤–∂–¥–∏ –ø–æ–∫–∞–∑—É—î–º–æ —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω –µ–ª–µ–º–µ–Ω—Ç
            if (category === '–¢–∞—î–º–Ω–∞') {
                count = 2;
            }

            if (category === '–ö–æ—Ä–º') {
                const foods = [
                    { id: 1, name: "–ó–≤–∏—á–∞–π–Ω–∏–π –∫–æ—Ä–º", price: 10, energy: 1, hunger: 1 },
                    { id: 2, name: "–ü—Ä–µ–º—ñ—É–º –∫–æ—Ä–º", price: 25, energy: 3, hunger: 2 }
                ];

                foods.forEach(food => {
                    const item = document.createElement('div');
                    item.className = 'shop-item food-category';

                    const image = document.createElement('div');
                    image.className = 'item-image';
                    image.style.backgroundImage = `url('shop/food_${food.id}.png')`;

                    const infoContainer = document.createElement('div');
                    infoContainer.className = 'item-info';

                    const name = document.createElement('div');
                    name.className = 'item-name';
                    name.textContent = food.name;

                    const price = document.createElement('div');
                    price.className = 'item-price';
                    price.textContent = `ü™ô${food.price}`;

                    const button = document.createElement('button');
                    button.className = 'buy-button';
                    button.textContent = '–ö–£–ü–ò–¢–ò';
                    button.onclick = function () {
                        buyFood(food, button);
                    };

                    infoContainer.appendChild(name);
                    infoContainer.appendChild(price);
                    infoContainer.appendChild(button);

                    item.appendChild(image);
                    item.appendChild(infoContainer);

                    shopContent.appendChild(item);
                });
            } else if (category === '–§–∞—Ä–º') {
                // –£ –§–∞—Ä–º –ø–æ–∫–∞–∑—É—î–º–æ —Ç—ñ–ª—å–∫–∏ 3 –ø—Ä–µ–¥–º–µ—Ç–∏
                const farmItems = [
                    { id: 1, name: "–¶–≤—ñ—Ç—É–π–æ—á–æ–∫", price: 60 },
                    { id: 2, name: "–ö–∞–∫—Ç—É—Å—å–æ–Ω–æ–∫", price: 100 },
                    { id: 3, name: "–ú–∞–≥—ñ—á–Ω–∏–π –≥—Ä–∏–±", price: 170 }
                ];
                farmItems.forEach(item => {
                    shopContent.appendChild(createShopItem(item, category));
                });
            } else {
                // –ö–∞—Å—Ç–æ–º–Ω—ñ –Ω–∞–∑–≤–∏ –¥–ª—è –≤—Å—ñ—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π, –∫—Ä—ñ–º –§–∞—Ä–º —ñ –ö–æ—Ä–º
                const customNames = {
                    '–ú–∏—Å–∫–∏': ['–¢—Ä–æ—Ö–∞ –≤–∞–Ω—é—á–∞', '–ì–ª–∏–±–æ–∫–∞ –º–∏—Å–∫–∞', '–£–¥–æ–±–Ω–∞ –º–∏—Å–∫–∞', '–ï–ª—ñ—Ç–Ω–∞ –º–∏—Å–∫–∞'],
                    '–õ–∞–º–ø–∏': ['–ü–æ–ª–æ–º–∞–Ω–∞ –ª–∞–º–ø–∞', '–ù–µ –æ—á —Å–≤—ñ—Ç–∏—Ç—å', '–ö—Ä–∞—Å—ñ–≤–∞ –ª–∞–º–ø–∞', '–í–∞—à–µ –±–æ–º–±–∞ –ª–∞–º–ø–∞'],
                    '–ö–∞—Ä—Ç–∏–Ω–∏': ['–ü—ñ–∫—Å–µ–ª—å–Ω–∏–π –ø–µ–π–∑–∞–∂', '–ö–∞—Ä—Ç–∏–Ω–∞ –∑ –∫–æ—Ç–∏–∫–æ–º', '–ê–±—Å—Ç—Ä–∞–∫—Ü—ñ—è', '–ü–æ—Å—Ç–µ—Ä –º—Ä—ñ–π'],
                    '–Ü–≥—Ä–∞—à–∫–∏': ['–ú–∏—à–∞ —Å—ñ—Ä–∞', '–ö–ª—É–±–æ–∫', '–ó–∞–±–∞–≤–∫–∞', '–ü–ª—é—à–µ–≤–∏–π –¥—Ä—É–≥'],
                    '–¢—É–º–±–æ—á–∫–∏': ['–ú–∞–ª–µ–Ω—å–∫–∞ —Ç—É–º–±–æ—á–∫–∞', '–¢—É–º–±–∞ –∑ —à—É—Ö–ª—è–¥–æ—é', '–î–æ—Ä–æ–≥–∞ —Ç—É–º–±–∞', '–¢—É–º–±–∞-–ï–ª—ñ—Ç–Ω–∞'],
                    '–¢–∞—î–º–Ω–∞': ['–ß–µ—Ä–Ω–∏—à', '–ú—ñ–Ω—ñ –±–µ–π–±—ñ']
                };

                if (category === '–¢–∞—î–º–Ω–∞') {
                    const secretItems = [
                        { id: 1, name: '–ß–µ—Ä–Ω–∏—à', price: 800 },
                        { id: 2, name: '–ú—ñ–Ω—ñ –±–µ–π–±—ñ', price: 1000 }
                    ];
                    secretItems.forEach(item => {
                        shopContent.appendChild(createShopItem(item, category));
                    });
                } else {
                    for (let i = 1; i <= count; i++) {
                        const namesForCategory = customNames[category] || [];
                        const displayName = namesForCategory[i - 1] || `${category} ${i}`;
                        const itemData = {
                            id: i,
                            name: displayName,
                            price: i * 10 + 30
                        };
                        shopContent.appendChild(createShopItem(itemData, category));
                    }
                }
            }
        }

        // –û–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è createShopItem –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤
        // –û–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
        function createShopItem(item, category, isFood = false) {
            if (!item || !item.id || !item.name || !item.price) {
                console.error('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è —Ç–æ–≤–∞—Ä—É:', item);
                return document.createElement('div'); // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ–π –µ–ª–µ–º–µ–Ω—Ç, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–∫–∏
            }

            const itemElement = document.createElement('div');
            let classes = ['shop-item'];
            if (isFood) classes.push('food-category');
            if (normalizeCategory(category).replace(/\s/g, '').toLowerCase() === '–º–∏—Å–∫–∏') classes.push('miska');
            itemElement.className = classes.join(' ');

            const image = document.createElement('div');
            image.className = 'item-image';
            if (category === '–¢—É–º–±–æ—á–∫–∏') image.classList.add('tumb');
            if (category === '–ö–∞—Ä—Ç–∏–Ω–∏') {
                image.classList.add('picture');
                image.style.transform = getPictureRotation(item.id);
            }
            if (category === '–Ü–≥—Ä–∞—à–∫–∏') image.classList.add('toy');
            if (category === '–§–∞—Ä–º') {
                let imageName = '';
                if (item.id === 1) imageName = `–§–∞—Ä–º-4.png`;
                else if (item.id === 2) imageName = `–§–∞—Ä–º–ö-4.png`;
                else if (item.id === 3) imageName = `–ì—Ä–∏–±-4.png`;
                else imageName = `–§–∞—Ä–º-${item.id}.png`;
                image.style.backgroundImage = `url('shop/${imageName}')`;
            } else if (category === '–¢–∞—î–º–Ω–∞') {
                if (item.id === 1) {
                    image.style.backgroundImage = `url('shop/img-black.png')`;
                } else if (item.id === 2) {
                    image.style.backgroundImage = `url('shop/img-baby.png')`;
                } else {
                    image.style.backgroundImage = `url('shop/${category.toLowerCase()}_${item.id}.png')`;
                }
            } else {
                image.style.backgroundImage = isFood
                    ? `url('shop/food_${item.id}.png')`
                    : (category === '–Ü–≥—Ä–∞—à–∫–∏' ? `url('shop/toy_${item.id}.png')` : `url('shop/${category.toLowerCase()}_${item.id}.png')`);
            }

            const infoContainer = document.createElement('div');
            infoContainer.className = 'item-info';

            const name = document.createElement('div');
            name.className = 'item-name';
            name.textContent = item.name;

            const price = document.createElement('div');
            price.className = 'item-price';
            price.textContent = `ü™ô${item.price}`;

            infoContainer.appendChild(name);
            infoContainer.appendChild(price);

            // –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É —ñ–Ω—Ñ–æ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –§–∞—Ä–º
            if (normalizeCategory(category) === '–§–∞—Ä–º') {
                const infoBtn = document.createElement('button');
                infoBtn.className = 'farm-info-btn';
                infoBtn.textContent = 'i';
                infoBtn.onclick = function(e) {
                    e.stopPropagation();
                    let infoText = '';
                    if (item.id === 1) infoText = '–ö–≤—ñ—Ç–∫–∞:\n–î–æ—Ö—ñ–¥: ü™ô15\n–ß–∞—Å —Ä–æ—Å—Ç—É: 3 –≥–æ–¥';
                    else if (item.id === 2) infoText = '–ö–∞–∫—Ç—É—Å:\n–î–æ—Ö—ñ–¥: ü™ô30\n–ß–∞—Å —Ä–æ—Å—Ç—É: 3 –≥–æ–¥';
                    else if (item.id === 3) infoText = '–ì—Ä–∏–±:\n–î–æ—Ö—ñ–¥: ü™ô50\n–ß–∞—Å —Ä–æ—Å—Ç—É: 3 –≥–æ–¥';
                    alert(infoText);
                };
                price.appendChild(infoBtn);
            }

            // –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –º–∞–ª–µ–Ω—å–∫–æ–≥–æ –∫–æ—Ç–∏–∫–∞ –¥–æ –ø–æ–∫—É–ø–∫–∏ —á–æ—Ä–Ω–æ–≥–æ
            const isBabyLocked = (normalizeCategory(category) === '–¢–∞—î–º–Ω–∞' && item.id === 2 && !isPurchased('–¢–∞—î–º–Ω–∞', 1));

            if (isPurchased(category, item.id)) {
                console.log('–î–æ–¥–∞—é purchased –¥–ª—è', category, item.id);
                itemElement.classList.add('purchased');
                const purchasedLabel = document.createElement('div');
                purchasedLabel.className = 'purchased-label';
                purchasedLabel.textContent = '–ö—É–ø–ª–µ–Ω–æ';
                infoContainer.appendChild(purchasedLabel);
                // –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É "–í–∏–¥–∞–ª–∏—Ç–∏" –¥–ª—è –≤—Å—ñ—Ö, –∫—Ä—ñ–º –º–∏—Å–æ–∫
                if (normalizeCategory(category).replace(/\s/g, '').toLowerCase() !== '–º–∏—Å–∫–∏') {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-button';
                    deleteBtn.textContent = '–í–∏–¥–∞–ª–∏—Ç–∏';
                    deleteBtn.onclick = function () {
                        showDeleteConfirm(() => {
                            // –í–∏–¥–∞–ª–∏—Ç–∏ –∑ –∫—ñ–º–Ω–∞—Ç–∏
                            const el = getPlacedItemElement(category, item.id);
                            if (el) el.remove();
                            removePurchased(category, item.id);
                            // –Ø–∫—â–æ —Ü–µ –§–∞—Ä–º ‚Äî –≤–∏–¥–∞–ª–∏—Ç–∏ –∑ flowerGallery —ñ purchasedItems
                            if (normalizeCategory(category) === '–§–∞—Ä–º') {
                                const gallery = document.getElementById('flowerGallery');
                                if (gallery) {
                                    gallery.innerHTML = '';
                                    gallery.style.display = 'none';
                                    if (gallery.parentElement && gallery.parentElement.classList.contains('placed-item') && gallery.parentElement.classList.contains('tumb')) {
                                        gallery.parentElement.removeChild(gallery);
                                    }
                                }
                                purchasedItems = purchasedItems.filter(obj => !(normalizeCategory(obj.category) === '–§–∞—Ä–º' && obj.id === item.id));
                                console.log('[delete] purchasedItems after delete:', purchasedItems);
                            } else if (normalizeCategory(category) === '–¢–∞—î–º–Ω–∞') {
                                if (item.id === 1) {
                                    const bc = document.querySelector('.black-cat');
                                    if (bc) bc.style.display = 'none';
                                } else if (item.id === 2) {
                                    const bb = document.querySelector('.baby-cat');
                                    if (bb) bb.style.display = 'none';
                                    const bh = document.getElementById('babyHearts');
                                    if (bh) bh.style.display = 'none';
                                }
                            }
                            loadCategoryItems(category);
                        });
                    };
                    console.log('–î–æ–¥–∞—é –∫–Ω–æ–ø–∫—É –≤–∏–¥–∞–ª–∏—Ç–∏', category, item.id);
                    // –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É —Å–∞–º–µ –ø—ñ—Å–ª—è purchasedLabel
                    infoContainer.appendChild(deleteBtn);
                }
            } else if (isBabyLocked) {
                const lockedLabel = document.createElement('div');
                lockedLabel.className = 'purchased-label';
                lockedLabel.textContent = 'üîí –°–ø–æ—á–∞—Ç–∫—É —á–µ—Ä–Ω–∏—à';
                infoContainer.appendChild(lockedLabel);
            } else {
                const button = document.createElement('button');
                button.className = 'buy-button';
                button.textContent = '–ö–£–ü–ò–¢–ò';
                button.onclick = function () {
                    buyItem(item.id, category, button, item.price);
                };
                infoContainer.appendChild(button);
            }

            itemElement.appendChild(image);
            itemElement.appendChild(infoContainer);

            return itemElement;
        }

        // –§—É–Ω–∫—Ü—ñ—è –ø–æ–∫—É–ø–∫–∏ –∫–æ—Ä–º—É
        function buyFood(food, button) {
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–æ–Ω–µ—Ç
            if (coins < food.price) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º–æ–Ω–µ—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∫–æ—Ä–º—É.');
                return;
            }
            // –°–ø–∏—Å—É—î–º–æ –º–æ–Ω–µ—Ç–∏
            coins -= food.price;
            updateBalanceUI();
            saveGameState();
            // –ë–ª–æ–∫—É—î–º–æ –≤—Å—ñ –∫–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–∫–∏ –∫–æ—Ä–º—É
            const allFoodButtons = document.querySelectorAll('.food-category .buy-button');
            allFoodButtons.forEach(btn => {
                btn.classList.add('loading');
                btn.disabled = true;
            });

            // –ü–æ–∫–∞–∑—É—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–ª—è –Ω–∞—Ç–∏—Å–Ω—É—Ç–æ—ó –∫–Ω–æ–ø–∫–∏
            button.classList.add('loading');
            button.disabled = true;

            // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ —Å—Ç—ñ–∫–µ—Ä–∏ –∑–ª–æ—Å—Ç—ñ –∞–±–æ —Å–Ω—É
            hideEmote();

            // –ó—É–ø–∏–Ω—è—î–º–æ –¥—ñ—ó –∫–æ—Ç–∞
            stopCatActions();

            // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∫–æ—Ç–∞ —ó—Å—Ç–∏
            feedCatSequence(food.hunger, food.energy, function () {
                // –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≥–æ–¥—É–≤–∞–Ω–Ω—è
                allFoodButtons.forEach(btn => {
                    btn.classList.remove('loading');
                    btn.disabled = false;
                });

                button.classList.remove('loading');
                button.disabled = false;

                console.log(`–ö–æ—Ç–∏–∫ –∑'—ó–≤ ${food.name} —Ç–∞ –≤—ñ–¥–Ω–æ–≤–∏–≤ ${food.energy} –µ–Ω–µ—Ä–≥—ñ—ó!`);
            });
        }

        function showMoreItems(category) {
            const shopContent = document.getElementById('shopContent');
            const viewMoreBtn = document.querySelector('.view-more');
            if (viewMoreBtn) viewMoreBtn.remove();

            for (let i = 5; i <= 8; i++) {
                shopContent.appendChild(createShopItem(i, category));
            }

            shopContent.scrollTop = shopContent.scrollHeight;
        }

        let currentItem = null;

        function buyItem(itemId, category, button, price) {
            const item = {
                id: itemId,
                name: `${category} ${itemId}`,
                category: category
            };
            if (typeof price !== 'number') {
                price = 0;
            }
            if (coins < price) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º–æ–Ω–µ—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —Ü—å–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞.');
                return;
            }
            coins -= price;
            updateBalanceUI();

            if (normalizeCategory(category).replace(/\s/g, '').toLowerCase() === '–º–∏—Å–∫–∏') {
                replaceBowl(itemId);
                currentBowlId = itemId;
                loadCategoryItems(category);
                saveGameState();
            } else if (category === '–§–∞—Ä–º') {
                // –í–∏–¥–∞–ª—è—î–º–æ –≤—Å—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –ø–æ–∫—É–ø–∫–∏ –∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó '–§–∞—Ä–º'
                purchasedItems = purchasedItems.filter(item => normalizeCategory(item.category) !== '–§–∞—Ä–º');
                // –û—á–∏—â–∞—î–º–æ –≥–∞–ª–µ—Ä–µ—é (–≤–∏–¥–∞–ª—è—î–º–æ –∫–≤—ñ—Ç–æ—á–∫—É/–∫–∞–∫—Ç—É—Å –∑ —Ç—É–º–±–æ—á–∫–∏)
                let gallery = document.getElementById('flowerGallery');
                if (gallery) {
                    gallery.innerHTML = '';
                    gallery.style.display = 'none';
                    if (gallery.parentElement && gallery.parentElement.classList.contains('placed-item') && gallery.parentElement.classList.contains('tumb')) {
                        gallery.parentElement.removeChild(gallery);
                    }
                }
                // –ó—É–ø–∏–Ω—è—é –≤—Å—ñ –∞–Ω—ñ–º–∞—Ü—ñ—ó –§–∞—Ä–º –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–æ–≤–æ—ó
                stopAllFarmAnimations();
                // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π –∫—É–ø–ª–µ–Ω–∏–π –ø—Ä–µ–¥–º–µ—Ç (–±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ isPurchased)
                purchasedItems.push({ category: category, id: itemId });
                // --- –î–æ–¥–∞—é flowerGallery —É DOM, —è–∫—â–æ –π–æ–≥–æ –Ω–µ–º–∞—î ---
                const tumb = document.querySelector('.placed-item.tumb');
                gallery = document.getElementById('flowerGallery');
                if (tumb && !gallery) {
                    gallery = document.createElement('div');
                    gallery.id = 'flowerGallery';
                    gallery.style.display = 'flex';
                    gallery.style.flexDirection = 'column';
                    gallery.style.alignItems = 'center';
                    gallery.style.marginTop = '70px';
                    tumb.appendChild(gallery);
                } else if (tumb && gallery && gallery.parentElement !== tumb) {
                    tumb.appendChild(gallery);
                }
                // --- –ö—ñ–Ω–µ—Ü—å –¥–æ–¥–∞–≤–∞–Ω–Ω—è flowerGallery ---
                if (itemId === 1) {
                    startFlowerGallery();
                } else if (itemId === 2) {
                    startCactusGallery();
                } else if (itemId === 3) {
                    startMushroomGallery();
                }
                setTimeout(function() {
                    const gallery = document.getElementById('flowerGallery');
                    const tumb = document.querySelector('.placed-item.tumb');
                    if (gallery && tumb) {
                        gallery.style.position = 'absolute';
                        gallery.style.left = '50%';
                        gallery.style.bottom = '79%';
                        gallery.style.transform = 'translateX(-50%)';
                        gallery.style.zIndex = '10';
                        tumb.appendChild(gallery);
                    }
                    saveGameState();
                }, 100);
                loadCategoryItems(category);
                registerFarmOnceTask();
                registerPurchaseForTask(category);
            } else if (normalizeCategory(category) === '–¢–∞—î–º–Ω–∞') {
                purchasedItems.push({ category: category, id: itemId });
                if (itemId === 1) {
                    const bc = document.querySelector('.black-cat');
                    if (bc) bc.style.display = 'block';
                } else if (itemId === 2) {
                    const bb = document.querySelector('.baby-cat');
                    if (bb) bb.style.display = 'block';
                }
                saveGameState(); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø—ñ—Å–ª—è –ø–æ–∫—É–ø–∫–∏ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ—Ç–∞
                loadCategoryItems(category);
                registerPurchaseForTask(category);
                return;
            } else {
                saveGameState();
                currentItem = document.createElement('div');
                currentItem.className = 'placed-item';
                currentItem.dataset.category = category;
                currentItem.dataset.id = itemId;
                if (category === '–¢—É–º–±–æ—á–∫–∏') currentItem.classList.add('tumb');
                if (category === '–ö–∞—Ä—Ç–∏–Ω–∏') {
                    currentItem.classList.add('picture');
                    currentItem.style.transform = getPictureRotation(itemId);
                }
                if (category === '–Ü–≥—Ä–∞—à–∫–∏') currentItem.classList.add('toy');
                currentItem.style.backgroundImage = (category === '–Ü–≥—Ä–∞—à–∫–∏')
                    ? `url('shop/toy_${itemId}.png')`
                    : `url('shop/${category}_${itemId}.png')`;
                currentItem.style.left = `${window.innerWidth / 2 - 50}px`;
                currentItem.style.top = `${window.innerHeight / 2 - 50}px`;
                document.body.appendChild(currentItem);

                addMovementButtons(currentItem);

                const placementControls = document.getElementById('placementControls');
                placementControls.style.display = 'flex';
                registerPurchaseForTask(category);
            }
        }

        function replaceBowl(itemId) {
            // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä—É –º–∏—Å–∫—É, —è–∫—â–æ –≤–æ–Ω–∞ —î
            if (currentBowl) {
                currentBowl.remove();
            }

            // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤—É –º–∏—Å–∫—É
            currentBowl = document.createElement('img');
            currentBowl.id = 'bowl';
            currentBowl.src = `shop/–ú–∏—Å–∫–∏_${itemId}.png`;
            currentBowl.alt = '–ú–∏—Å–∫–∞';
            currentBowl.style.position = 'absolute';
            currentBowl.style.bottom = '10px';
            currentBowl.style.right = '10px';
            currentBowl.style.width = '80px';
            currentBowl.style.height = '80px';
            currentBowl.style.cursor = 'pointer';
            currentBowl.style.zIndex = '1';

            // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –≥–æ–¥—É–≤–∞–Ω–Ω—è
            currentBowl.addEventListener('click', () => {
                if (isEating) {
                    console.log('–ö–æ—Ç–∏–∫ –≤–∂–µ —ó—Å—Ç—å');
                    return;
                }
                if (coins < BOWL_FEED_COST) {
                    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º–æ–Ω–µ—Ç –¥–ª—è –≥–æ–¥—É–≤–∞–Ω–Ω—è –∑ –º–∏—Å–∫–∏.');
                    return;
                }
                coins -= BOWL_FEED_COST;
                updateBalanceUI();
                console.log('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–Ω—É–≤ –Ω–∞ –º–∏—Å–∫—É');
                hideEmote(); // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ —Å–º–∞–π–ª–∏–∫–∏ –ø–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º —Ä—É—Ö—É –¥–æ –º–∏—Å–∫–∏
                feedCatSequence();
            });

            // –î–æ–¥–∞—î–º–æ –Ω–æ–≤—É –º–∏—Å–∫—É –¥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
            document.body.appendChild(currentBowl);
        }

        // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –∑–∞–≤–¥–∞–Ω—å
        function openTasks() {
            const tasksOverlay = document.getElementById('tasksOverlay');
            const tasksContent = document.getElementById('tasksContent');
            loadTasksState();
            tasksContent.innerHTML = '';

            // –©–æ–¥–µ–Ω–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è: –í—Ö—ñ–¥
            const dailyEl = document.createElement('div');
            dailyEl.className = 'task-item';
            const dailyInfo = document.createElement('div');
            dailyInfo.className = 'task-info';
            const dailyName = document.createElement('div');
            dailyName.className = 'task-name';
            
            // –õ–æ–≥—ñ–∫–∞ streak (—Å–µ—Ä—ñ—ó –≤—Ö–æ–¥—ñ–≤)
            if (!tasksState.dailyLogin.streak) tasksState.dailyLogin.streak = 1;
            const currentStreak = tasksState.dailyLogin.streak;
            const currentReward = 10 + (currentStreak * 10); // 20, 30, 40, 50, 60
            
            dailyName.textContent = `–í—Ö—ñ–¥ —â–æ–¥–Ω—è (–î–µ–Ω—å ${currentStreak}/5)`;
            const dailyReward = document.createElement('div');
            dailyReward.className = 'task-reward';
            dailyReward.textContent = `–ù–∞–≥–æ—Ä–æ–¥–∞: ü™ô${currentReward}`;
            
            const dailyBtn = document.createElement('button');
            dailyBtn.className = 'task-button';
            const dlLeft = timeLeft(tasksState.dailyLogin.nextAvailable);
            
            if (dlLeft === 0) {
                dailyBtn.textContent = '–û–¢–†–ò–ú–ê–¢–ò';
                dailyBtn.onclick = function () {
                    coins += currentReward;
                    updateBalanceUI();
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ streak: —è–∫—â–æ 5-–π –¥–µ–Ω—å, —Å–∫–∏–¥–∞—î–º–æ –¥–æ 1, —ñ–Ω–∞–∫—à–µ +1
                    if (tasksState.dailyLogin.streak >= 5) {
                        tasksState.dailyLogin.streak = 1;
                    } else {
                        tasksState.dailyLogin.streak++;
                    }
                    
                    tasksState.dailyLogin.nextAvailable = nowMs() + DAY_MS;
                    saveTasksState();
                    saveGameState(); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –±–∞–ª–∞–Ω—Å –º–æ–Ω–µ—Ç
                    openTasks();
                };
            } else {
                dailyBtn.textContent = `–û—á—ñ–∫—É–π—Ç–µ ${formatTime(dlLeft)}`;
                dailyBtn.disabled = true;
            }
            dailyInfo.appendChild(dailyName);
            dailyInfo.appendChild(dailyReward);
            dailyEl.appendChild(dailyInfo);
            dailyEl.appendChild(dailyBtn);
            tasksContent.appendChild(dailyEl);

            // –ó–∞–≤–¥–∞–Ω–Ω—è: –ü–æ–∫–æ—Ä–º–∏ –∫–æ—Ç–∏–∫–∞ 5 —Ä–∞–∑—ñ–≤ (—â–æ–¥–µ–Ω–Ω–µ, —Ç–∞–π–º–µ—Ä –≤—ñ–¥ –º–æ–º–µ–Ω—Ç—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è)
            const feedEl = document.createElement('div');
            feedEl.className = 'task-item';
            const feedInfo = document.createElement('div');
            feedInfo.className = 'task-info';
            const feedName = document.createElement('div');
            feedName.className = 'task-name';
            feedName.textContent = '–ü–æ–∫–æ—Ä–º–∏ –∫–æ—Ç–∏–∫–∞ 5 —Ä–∞–∑—ñ–≤';
            const feedReward = document.createElement('div');
            feedReward.className = 'task-reward';
            feedReward.textContent = `–ù–∞–≥–æ—Ä–æ–¥–∞: ü™ô${tasksState.feed5.reward} | –ü—Ä–æ–≥—Ä–µ—Å: ${tasksState.feed5.count}/5`;
            const feedBtn = document.createElement('button');
            feedBtn.className = 'task-button';
            const fLeft = timeLeft(tasksState.feed5.nextAvailable);
            if (fLeft > 0) {
                feedBtn.textContent = `–û—á—ñ–∫—É–π—Ç–µ ${formatTime(fLeft)}`;
                feedBtn.disabled = true;
            } else {
                feedBtn.textContent = '–ì–æ–¥—É–π—Ç–µ –∫–æ—Ç–∏–∫–∞';
                feedBtn.disabled = true;
            }
            feedInfo.appendChild(feedName);
            feedInfo.appendChild(feedReward);
            feedEl.appendChild(feedInfo);
            feedEl.appendChild(feedBtn);
            tasksContent.appendChild(feedEl);

            // –ó–∞–≤–¥–∞–Ω–Ω—è: –ü–æ–∫—É–ø–∫–∞ –Ω–æ–≤–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ (—â–æ–¥–µ–Ω–Ω–µ)
            const shopEl = document.createElement('div');
            shopEl.className = 'task-item';
            const shopInfo = document.createElement('div');
            shopInfo.className = 'task-info';
            const shopName = document.createElement('div');
            shopName.className = 'task-name';
            shopName.textContent = '–ö—É–ø–∏ –Ω–æ–≤–∏–π –ø—Ä–µ–¥–º–µ—Ç —É –º–∞–≥–∞–∑–∏–Ω—ñ';
            const shopReward = document.createElement('div');
            shopReward.className = 'task-reward';
            shopReward.textContent = `–ù–∞–≥–æ—Ä–æ–¥–∞: ü™ô${tasksState.purchaseDaily.reward}`;
            const shopBtn = document.createElement('button');
            shopBtn.className = 'task-button';
            const pLeft = timeLeft(tasksState.purchaseDaily.nextAvailable);
            if (pLeft > 0) {
                shopBtn.textContent = `–û—á—ñ–∫—É–π—Ç–µ ${formatTime(pLeft)}`;
                shopBtn.disabled = true;
            } else {
                shopBtn.textContent = '–ö—É–ø—ñ—Ç—å –±—É–¥—å-—è–∫–∏–π –ø—Ä–µ–¥–º–µ—Ç';
                shopBtn.disabled = true;
            }
            shopInfo.appendChild(shopName);
            shopInfo.appendChild(shopReward);
            shopEl.appendChild(shopInfo);
            shopEl.appendChild(shopBtn);
            tasksContent.appendChild(shopEl);

            // –ó–∞–≤–¥–∞–Ω–Ω—è: –ö—É–ø–∏—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç –∑ —Ä–æ–∑–¥—ñ–ª—É –§–∞—Ä–º (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–µ)
            const farmEl = document.createElement('div');
            farmEl.className = 'task-item';
            const farmInfo = document.createElement('div');
            farmInfo.className = 'task-info';
            const farmName = document.createElement('div');
            farmName.className = 'task-name';
            farmName.textContent = '–ö—É–ø–∏ –ø—Ä–µ–¥–º–µ—Ç –∑ —Ä–æ–∑–¥—ñ–ª—É –§–∞—Ä–º (1 —Ä–∞–∑ –∑–∞ –≥—Ä—É)';
            const farmReward = document.createElement('div');
            farmReward.className = 'task-reward';
            farmReward.textContent = `–ù–∞–≥–æ—Ä–æ–¥–∞: ü™ô${tasksState.farmOnce.reward}`;
            const farmBtn = document.createElement('button');
            farmBtn.className = 'task-button';
            if (tasksState.farmOnce.completed) {
                farmBtn.textContent = '–í–∏–∫–æ–Ω–∞–Ω–æ';
                farmBtn.disabled = true;
            } else {
                farmBtn.textContent = '–ö—É–ø—ñ—Ç—å —É –§–∞—Ä–º';
                farmBtn.disabled = true;
            }
            farmInfo.appendChild(farmName);
            farmInfo.appendChild(farmReward);
            farmEl.appendChild(farmInfo);
            farmEl.appendChild(farmBtn);
            tasksContent.appendChild(farmEl);

            // --- –ó–∞–≤–¥–∞–Ω–Ω—è –¥–Ω—è (–ö–æ–º–ø–ª–µ–∫—Å–Ω–µ) ---
            const complexEl = document.createElement('div');
            complexEl.className = 'task-item complex-task';
            const complexInfo = document.createElement('div');
            complexInfo.className = 'task-info';
            const complexName = document.createElement('div');
            complexName.className = 'task-name';
            complexName.textContent = 'üìã –ó–∞–≤–¥–∞–Ω–Ω—è –¥–Ω—è';
            
            const task = tasksState.dailyComplex;
            const complexReward = document.createElement('div');
            complexReward.className = 'task-reward';
            complexReward.textContent = `–ù–∞–≥–æ—Ä–æ–¥–∞: ü™ô${task.reward}`;
            
            const progressContainer = document.createElement('div');
            progressContainer.style.fontSize = '12px';
            progressContainer.style.color = '#ccc';
            progressContainer.style.marginTop = '5px';
            
            const p1 = document.createElement('div');
            p1.textContent = `‚Ä¢ –ü–æ–≥–ª–∞–¥—å –∫–æ—Ç–∏–∫–∞: ${task.petCount}/10`;
            p1.style.color = task.petCount >= 10 ? '#4caf50' : '#ccc';
            
            const p2 = document.createElement('div');
            p2.textContent = `‚Ä¢ –ó–ª–æ–≤–∏ –º–æ–Ω–µ—Ç–∏: ${task.coinsCaught}/3`;
            p2.style.color = task.coinsCaught >= 3 ? '#4caf50' : '#ccc';
            
            const p3 = document.createElement('div');
            p3.textContent = `‚Ä¢ –í–∏—Ä–æ—Å—Ç–∏ —Ä–æ—Å–ª–∏–Ω—É: ${task.farmGrown ? '–¢–∞–∫' : '–ù—ñ'}`;
            p3.style.color = task.farmGrown ? '#4caf50' : '#ccc';
            
            progressContainer.appendChild(p1);
            progressContainer.appendChild(p2);
            progressContainer.appendChild(p3);
            
            const complexBtn = document.createElement('button');
            complexBtn.className = 'task-button';
            const cLeft = timeLeft(task.nextAvailable);
            
            if (cLeft > 0) {
                complexBtn.textContent = `–û—á—ñ–∫—É–π—Ç–µ ${formatTime(cLeft)}`;
                complexBtn.disabled = true;
            } else {
                if (task.petCount >= 10 && task.coinsCaught >= 3 && task.farmGrown) {
                    complexBtn.textContent = '–û–¢–†–ò–ú–ê–¢–ò';
                    complexBtn.onclick = function() {
                        checkDailyComplexTask();
                        openTasks();
                    };
                } else {
                    complexBtn.textContent = '–£ –ø—Ä–æ—Ü–µ—Å—ñ';
                    complexBtn.disabled = true;
                }
            }
            
            complexInfo.appendChild(complexName);
            complexInfo.appendChild(complexReward);
            complexInfo.appendChild(progressContainer);
            complexEl.appendChild(complexInfo);
            complexEl.appendChild(complexBtn);
            tasksContent.appendChild(complexEl);

            tasksOverlay.style.display = 'flex';
            setTimeout(() => {
                tasksOverlay.style.opacity = '1';
            }, 10);
        }

        function closeTasks() {
            const tasksOverlay = document.getElementById('tasksOverlay');
            tasksOverlay.style.opacity = '0';
            setTimeout(() => {
                tasksOverlay.style.display = 'none';
            }, 300);
        }

        function registerFeedingForTask() {
            loadTasksState();
            if (timeLeft(tasksState.feed5.nextAvailable) > 0) {
                saveTasksState();
                return;
            }
            tasksState.feed5.count = (tasksState.feed5.count || 0) + 1;
            if (tasksState.feed5.count >= 5) {
                coins += tasksState.feed5.reward;
                updateBalanceUI();
                tasksState.feed5.count = 0;
                tasksState.feed5.nextAvailable = nowMs() + DAY_MS;
                saveGameState(); // Save reward coins
            }
            saveTasksState();
        }
        function registerPurchaseForTask(category) {
            loadTasksState();
            const norm = normalizeCategory(category);
            if (timeLeft(tasksState.purchaseDaily.nextAvailable) === 0 && norm !== '–ö–æ—Ä–º') {
                coins += tasksState.purchaseDaily.reward;
                updateBalanceUI();
                tasksState.purchaseDaily.nextAvailable = nowMs() + DAY_MS;
                saveTasksState();
                saveGameState(); // Save reward coins
            }
        }
        function registerFarmOnceTask() {
            loadTasksState();
            if (!tasksState.farmOnce.completed) {
                tasksState.farmOnce.completed = true;
                coins += tasksState.farmOnce.reward;
                updateBalanceUI();
                saveTasksState();
            }
        }

        function registerFarmHarvestTask() {
            loadTasksState();
            if (timeLeft(tasksState.dailyComplex.nextAvailable) === 0) {
                tasksState.dailyComplex.farmGrown = true;
                checkDailyComplexTask();
                saveTasksState();
                saveGameState(); // Ensure all progress is captured
            }
        }

        function checkDailyComplexTask() {
            if (timeLeft(tasksState.dailyComplex.nextAvailable) > 0) return;
            
            const task = tasksState.dailyComplex;
            if (task.petCount >= 10 && task.coinsCaught >= 3 && task.farmGrown) {
                coins += task.reward;
                updateBalanceUI();
                task.nextAvailable = nowMs() + DAY_MS;
                // Reset for next time
                task.petCount = 0;
                task.coinsCaught = 0;
                task.farmGrown = false;
                alert('–í—ñ—Ç–∞—î–º–æ! –í–∏ –≤–∏–∫–æ–Ω–∞–ª–∏ –ó–∞–≤–¥–∞–Ω–Ω—è –¥–Ω—è —Ç–∞ –æ—Ç—Ä–∏–º–∞–ª–∏ ü™ô70!');
                saveTasksState();
                saveGameState(); // Save coins balance
            }
        }

        function choosePlacement(item) {
            const placementOverlay = document.getElementById('placementOverlay');
            const placementGrid = document.getElementById('placementGrid');

            // –û—á–∏—â–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –º—ñ—Å—Ü—è
            placementGrid.innerHTML = '';

            // –î–æ–¥–∞—î–º–æ –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω—ñ –º—ñ—Å—Ü—è
            // –û—á–∏—â–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –º—ñ—Å—Ü—è
            placementGrid.innerHTML = '';

            // –î–æ–¥–∞—î–º–æ –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω—ñ –º—ñ—Å—Ü—è
            for (let i = 0; i < 9; i++) {
                const place = document.createElement('div');
                place.textContent = i + 1; // –ù—É–º–µ—Ä–∞—Ü—ñ—è –º—ñ—Å—Ü—å
                place.onclick = function () {
                    placeItem(item, i + 1); // –†–æ–∑–º—ñ—â—É—î–º–æ –ø—Ä–µ–¥–º–µ—Ç
                };
                placementGrid.appendChild(place);
            }

            // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –≤–∏–±—ñ—Ä –º—ñ—Å—Ü—è
            placementOverlay.style.display = 'flex';
        }

        function cancelPlacement() {
            // –í–∏–¥–∞–ª—è—î–º–æ –ø—Ä–µ–¥–º–µ—Ç —ñ —Å–∫–∞—Å–æ–≤—É—î–º–æ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è
            if (currentItem) {
                currentItem.remove();
                currentItem = null;
            }
            cleanupPlacement();
        }

        // –î–æ–¥–∞—é –º–∞–ø—É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
        const categoryMap = {
            'tumb–æ—á–∫–∏': '–¢—É–º–±–æ—á–∫–∏',
            '—ñ–≥—Ä–∞—à–∫–∏': '–Ü–≥—Ä–∞—à–∫–∏',
            'igrashki': '–Ü–≥—Ä–∞—à–∫–∏',
            'toy': '–Ü–≥—Ä–∞—à–∫–∏',
            'tumb': '–¢—É–º–±–æ—á–∫–∏',
            '–∫–∞—Ä—Ç–∏–Ω–∏': '–ö–∞—Ä—Ç–∏–Ω–∏',
            'kartini': '–ö–∞—Ä—Ç–∏–Ω–∏',
            'lam–ø–∏': '–õ–∞–º–ø–∏',
            'lamps': '–õ–∞–º–ø–∏',
            '–º–∏—Å–∫–∏': '–ú–∏—Å–∫–∏',
            'misky': '–ú–∏—Å–∫–∏',
            'farm': '–§–∞—Ä–º',
            '—Ç–∞—î–º–Ω–∞': '–¢–∞—î–º–Ω–∞',
            'taemna': '–¢–∞—î–º–Ω–∞',
            // –¥–æ–¥–∞–π—Ç–µ —ñ–Ω—à—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑–∞ –ø–æ—Ç—Ä–µ–±–∏
        };
        function normalizeCategory(cat) {
            cat = cat.toLowerCase();
            return categoryMap[cat] || cat[0].toUpperCase() + cat.slice(1);
        }

        function finalizePlacement() {
            // –ó–∞–≤–µ—Ä—à—É—î–º–æ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è
            if (currentItem) {
                // –í–∏–∑–Ω–∞—á–∞—î–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é —Ç–∞ id –∑ backgroundImage
                let bg = currentItem.style.backgroundImage;
                let match = bg.match(/shop\/([–ê-–Ø–∞-—èA-Za-z]+)_(\d+)\.png/);
                if (match) {
                    // –Ø–∫—â–æ —Ü–µ toy, —è–≤–Ω–æ —Å—Ç–∞–≤–∏–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –Ü–≥—Ä–∞—à–∫–∏
                    let category = (match[1] === 'toy') ? '–Ü–≥—Ä–∞—à–∫–∏' : normalizeCategory(match[1]);
                    let id = parseInt(match[2]);
                    if (!isPurchased(category, id)) {
                        purchasedItems.push({ category: normalizeCategory(category), id });
                        // –û–ù–û–í–õ–ï–ù–ù–Ø –ö–ê–¢–ï–ì–û–†–Ü–ô –î–õ–Ø –¢–£–ú–ë–û–ß–ö–ò
                        if (normalizeCategory(category) === '–¢—É–º–±–æ—á–∫–∏') {
                            if (document.getElementById('categoriesContainer')) {
                                openShop();
                            }
                        }
                    }
                }
                saveGameState(); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å—Ç–∞–Ω –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è
            }
            cleanupPlacement();
            // –û–Ω–æ–≤–ª—é—î–º–æ –º–∞–≥–∞–∑–∏–Ω (—è–∫—â–æ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π)
            const activeCat = document.querySelector('.category.active');
            if (activeCat) loadCategoryItems(activeCat.textContent);
        }

        function cleanupPlacement() {
            const buttons = document.querySelectorAll('.move-button');
            buttons.forEach(button => button.remove());

            const placementControls = document.getElementById('placementControls');
            placementControls.style.display = 'none';

            document.removeEventListener('keydown', moveItemWithArrows);
        }

        function placeItem(item, position) {
            const placementOverlay = document.getElementById('placementOverlay');
            placementOverlay.style.display = 'none';

            // –õ–æ–≥—ñ–∫–∞ –¥–ª—è —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –ø—Ä–µ–¥–º–µ—Ç–∞ (–∫—Ä—ñ–º –§–∞—Ä–º)
            if (item.category === '–§–∞—Ä–º') {
                // –ù—ñ—á–æ–≥–æ –Ω–µ –¥–æ–¥–∞—î–º–æ –≤ –∫—ñ–º–Ω–∞—Ç—É
                return;
            }
            const newItem = document.createElement('div');
            newItem.className = 'placed-item';
            if (item.category === '–¢—É–º–±–æ—á–∫–∏') newItem.classList.add('tumb');
            if (item.category === '–ö–∞—Ä—Ç–∏–Ω–∏') {
                newItem.classList.add('picture');
                newItem.style.transform = getPictureRotation(item.id);
            }
            if (item.category === '–Ü–≥—Ä–∞—à–∫–∏') newItem.classList.add('toy');
            newItem.style.backgroundImage = (item.category === '–Ü–≥—Ä–∞—à–∫–∏')
                ? `url('shop/toy_${item.id}.png')`
                : `url('shop/${item.category.toLowerCase()}_${item.id}.png')`;
            newItem.style.position = 'absolute';
            newItem.style.left = `${50 + position * 50}px`;
            newItem.style.top = `50px`;
            document.body.appendChild(newItem);
        }

        function moveItemWithArrows(event) {
            if (!currentItem) return;

            const step = 10;
            let deltaX = 0;
            let deltaY = 0;

            switch (event.key) {
                case 'ArrowUp':
                    deltaY = -step;
                    break;
                case 'ArrowDown':
                    deltaY = step;
                    break;
                case 'ArrowLeft':
                    deltaX = -step;
                    break;
                case 'ArrowRight':
                    deltaX = step;
                    break;
            }

            moveItem(currentItem, deltaX, deltaY);
        }

        function addMovementButtons(item) {
            const directions = [
                { name: 'up', x: 0, y: -10 },
                { name: 'down', x: 0, y: 10 },
                { name: 'left', x: -10, y: 0 },
                { name: 'right', x: 10, y: 0 }
            ];

            const placementControls = document.getElementById('placementControls');
            const rect = placementControls.getBoundingClientRect();

            directions.forEach(direction => {
                const button = document.createElement('button');
                button.className = `move-button move-${direction.name}`;
                button.textContent = direction.name === 'up' ? '‚Üë' : direction.name === 'down' ? '‚Üì' : direction.name === 'left' ? '‚Üê' : '‚Üí';
                button.onclick = () => moveItem(item, direction.x, direction.y);

                // –ü–æ–∑–∏—Ü—ñ–æ–Ω—É—î–º–æ –∫–Ω–æ–ø–∫–∏ –Ω–∞–¥ –∫–Ω–æ–ø–∫–∞–º–∏ "–ì–æ—Ç–æ–≤–æ" —Ç–∞ "–°–∫–∞—Å—É–≤–∞—Ç–∏"
                switch (direction.name) {
                    case 'up':
                        button.style.left = `${rect.left + rect.width / 2 - button.offsetWidth / 2}px`;
                        button.style.top = `${rect.top - 60}px`; // –ù–∞–¥ –∫–Ω–æ–ø–∫–∞–º–∏
                        break;
                    case 'down':
                        button.style.left = `${rect.left + rect.width / 2 - button.offsetWidth / 2}px`;
                        button.style.top = `${rect.top - 10}px`; // –¢—Ä–æ—Ö–∏ –≤–∏—â–µ –∫–Ω–æ–ø–æ–∫
                        break;
                    case 'left':
                        button.style.left = `${rect.left - button.offsetWidth - 10}px`;
                        button.style.top = `${rect.top - 35}px`; // –í–∏—Ä—ñ–≤–Ω—é—î–º–æ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—ñ
                        break;
                    case 'right':
                        button.style.left = `${rect.right + 10}px`;
                        button.style.top = `${rect.top - 35}px`; // –í–∏—Ä—ñ–≤–Ω—é—î–º–æ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—ñ
                        break;
                }

                document.body.appendChild(button);
            });
        }

        function moveItem(item, deltaX, deltaY) {
            let currentLeft = parseInt(item.style.left) || 0;
            let currentTop = parseInt(item.style.top) || 0;

            let newLeft = currentLeft + deltaX;
            let newTop = currentTop + deltaY;

            const parentRect = document.body.getBoundingClientRect();
            const itemWidth = item.offsetWidth;
            const itemHeight = item.offsetHeight;

            if (newLeft < 0) newLeft = 0;
            if (newTop < 0) newTop = 0;
            
            if (item.classList.contains('tumb')) {
                const maxLeft = parentRect.width - itemWidth - 10;
                if (newLeft > maxLeft) {
                    newLeft = maxLeft;
                }
            } else {
                if (newLeft + itemWidth > parentRect.width) newLeft = parentRect.width - itemWidth;
            }

            if (newTop + itemHeight > parentRect.height) newTop = parentRect.height - itemHeight;

            item.style.left = `${newLeft}px`;
            item.style.top = `${newTop}px`;

            updateButtonPositions(item);
        }

        function updateButtonPositions(item) {
            const buttons = document.querySelectorAll('.move-button');
            const rect = item.getBoundingClientRect();

            buttons.forEach(button => {
                if (button.classList.contains('move-up')) {
                    button.style.left = `${rect.left + rect.width / 2 - button.offsetWidth / 2}px`;
                    button.style.top = `${rect.top - button.offsetHeight - 10}px`;
                } else if (button.classList.contains('move-down')) {
                    button.style.left = `${rect.left + rect.width / 2 - button.offsetWidth / 2}px`;
                    button.style.top = `${rect.bottom + 10}px`;
                } else if (button.classList.contains('move-left')) {
                    button.style.left = `${rect.left - button.offsetWidth - 10}px`;
                    button.style.top = `${rect.top + rect.height / 2 - button.offsetHeight / 2}px`;
                } else if (button.classList.contains('move-right')) {
                    button.style.left = `${rect.right + 10}px`;
                    button.style.top = `${rect.top + rect.height / 2 - button.offsetHeight / 2}px`;
                }
            });
        }

        function initializeBowl() {
            // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—É –º–∏—Å–∫—É –∞–±–æ –¥–µ—Ñ–æ–ª—Ç–Ω—É (id = 1)
            replaceBowl(currentBowlId || 1);
        }


        function getPictureRotation(id) {
            // –î—É–∂–µ –º–∞–ª–µ–Ω—å–∫—ñ –∫—É—Ç–∏ –¥–ª—è –º–∞–π–∂–µ –Ω–µ–ø–æ–º—ñ—Ç–Ω–æ–≥–æ –Ω–∞—Ö–∏–ª—É
            const angles = [
                -1.2, 0.8, -0.7, 1.1, 0.5, -0.6, 1.2, -1.1
            ];
            return `rotate(${angles[(id - 1) % angles.length]}deg)`;
        }

        let purchasedItems = [];

        function isPurchased(category, id) {
            const normCat = normalizeCategory(category);
            if (normCat.replace(/\s/g, '').toLowerCase() === '–º–∏—Å–∫–∏') {
                return id === currentBowlId;
            }
            if (normCat.replace(/\s/g, '').toLowerCase() === '—Ñ–∞—Ä–º') {
                return purchasedItems.some(item => normalizeCategory(item.category) === normCat && item.id === id);
            }
            return purchasedItems.some(item => normalizeCategory(item.category) === normCat && item.id === id);
        }

        function removePurchased(category, id) {
            const normCat = normalizeCategory(category);
            const before = purchasedItems.length;
            purchasedItems = purchasedItems.filter(item => !(normalizeCategory(item.category) === normCat && item.id === id));
            const after = purchasedItems.length;
            console.log(`[removePurchased] category: ${category}, id: ${id}, before: ${before}, after: ${after}`);
            saveGameState(); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å—Ç–∞–Ω –ø—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
        }

        function getPlacedItemElement(category, id) {
            // –ü–æ—à—É–∫ –µ–ª–µ–º–µ–Ω—Ç–∞ –≤ –∫—ñ–º–Ω–∞—Ç—ñ –∑–∞ backgroundImage
            const all = document.querySelectorAll('.placed-item');
            for (const el of all) {
                // –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è: –¥–ª—è —ñ–≥—Ä–∞—à–æ–∫ —à—É–∫–∞—î–º–æ toy_X.png
                if (category === '–Ü–≥—Ä–∞—à–∫–∏') {
                    if (el.style.backgroundImage.includes(`toy_${id}.png`)) return el;
                } else {
                    if (el.style.backgroundImage.includes(`${category.toLowerCase()}_${id}.png`)) return el;
                }
            }
            return null;
        }

        // –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
        let deleteConfirmCallback = null;
        function showDeleteConfirm(onConfirm) {
            deleteConfirmCallback = onConfirm;
            const modal = document.getElementById('deleteConfirmModal');
            modal.style.display = 'flex';
        }
        function hideDeleteConfirm() {
            const modal = document.getElementById('deleteConfirmModal');
            modal.style.display = 'none';
            deleteConfirmCallback = null;
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—ó –µ–∫—Ä–∞–Ω—É
        function checkOrientation() {
            const overlay = document.getElementById('rotateScreenOverlay');

            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –µ–∫—Ä–∞–Ω –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∏–π —ñ —á–∏ —Ü–µ –º–æ–±—ñ–ª—å–Ω–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π
            if (window.innerHeight < window.innerWidth && window.innerHeight < 600) {
                overlay.style.display = 'flex';
            } else {
                overlay.style.display = 'none';
            }
        }

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—é –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.addEventListener('load', checkOrientation);

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—é –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ä–æ–∑–º—ñ—Ä—É –≤—ñ–∫–Ω–∞
        window.addEventListener('resize', checkOrientation);

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—é –ø—Ä–∏ –∑–º—ñ–Ω—ñ –æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—ó (–¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤)
        window.addEventListener('orientationchange', function () {
            setTimeout(checkOrientation, 100);
        });

        // --- –ì–∞–ª–µ—Ä–µ—è —Ä–æ—Å—Ç—É –∫–≤—ñ—Ç–æ—á–∫–∏ ---
        let flowerGalleryInterval = null;
        let flowerCurrentStage = 0;
        let flowerNextTs = 0;
        const flowerImages = [
            'shop/–§–∞—Ä–º_1.png',
            'shop/–§–∞—Ä–º-2.png',
            'shop/–§–∞—Ä–º-3.png',
            'shop/–§–∞—Ä–º-4.png'
        ];

        // === –ó—É–ø–∏–Ω–∫–∞ –≤—Å—ñ—Ö –∞–Ω—ñ–º–∞—Ü—ñ–π –§–∞—Ä–º ===
        function stopAllFarmAnimations() {
            if (flowerGalleryInterval) clearInterval(flowerGalleryInterval);
            if (cactusGalleryInterval) clearInterval(cactusGalleryInterval);
            if (mushroomGalleryInterval) clearInterval(mushroomGalleryInterval);
            const gallery = document.getElementById('flowerGallery');
            if (gallery) gallery.innerHTML = '';
        }

        function startFlowerGallery() {
            const gallery = document.getElementById('flowerGallery');
            if (!gallery) return;
            gallery.style.display = 'flex';
            flowerCurrentStage = 0;
            renderFlowerGallery();
            startFlowerInterval();
        }

        function renderFlowerGallery() {
            const gallery = document.getElementById('flowerGallery');
            if (!gallery) return;

            gallery.innerHTML = '';
            // –î–æ–¥–∞—î–º–æ —Ç–µ–∫—Å—Ç –∑ —Å—Ç—Ä—ñ–ª–∫–æ—é –≤–Ω–∏–∑ —Ç—ñ–ª—å–∫–∏ –Ω–∞ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Å—Ç–∞–¥—ñ—ó
            if (flowerCurrentStage === 3) {
                const label = document.createElement('div');
                label.className = 'harvest-label';
                label.innerHTML = '–£—Ä–æ–∂–∞–π <span style="font-size:21px;">‚Üì</span>';
                gallery.appendChild(label);
            }
            const img = document.createElement('img');
            img.src = flowerImages[flowerCurrentStage];
            img.className = 'flower-img' + (flowerCurrentStage === 0 ? ' small' : '');
            img.alt = `–ö–≤—ñ—Ç–∫–∞ –µ—Ç–∞–ø ${flowerCurrentStage + 1}`;
            if (flowerCurrentStage === 3) {
                img.style.cursor = 'pointer';
                img.onclick = function () {
                    coins += HARVEST_REWARD_FLOWER;
                    updateBalanceUI();
                    registerFarmHarvestTask();
                    flowerCurrentStage = 0;
                    renderFlowerGallery();
                    startFlowerInterval();
                };
            } else {
                img.onclick = null;
                img.style.cursor = 'default';
            }
            gallery.appendChild(img);
        }

        function startFlowerInterval() {
            if (flowerGalleryInterval) clearInterval(flowerGalleryInterval);
            const now = nowMs();
            const nextTs = flowerNextTs && flowerNextTs > now ? flowerNextTs : now + FARM_STAGE_MS;
            const delay = nextTs - now;
            setTimeout(() => {
                if (flowerCurrentStage < 3) {
                    flowerCurrentStage++;
                    flowerNextTs = nowMs() + FARM_STAGE_MS;
                    renderFlowerGallery();
                    saveGameState();
                    if (flowerCurrentStage === 3) return;
                    flowerGalleryInterval = setInterval(() => {
                        if (flowerCurrentStage < 3) {
                            flowerCurrentStage++;
                            flowerNextTs = nowMs() + FARM_STAGE_MS;
                            renderFlowerGallery();
                            saveGameState();
                            if (flowerCurrentStage === 3) clearInterval(flowerGalleryInterval);
                        }
                    }, FARM_STAGE_MS);
                }
            }, delay);
        }

        // --- –ú–∞–≥–∞–∑–∏–Ω: –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –§–∞—Ä–º –¥–æ –ø–æ–∫—É–ø–∫–∏ —Ç—É–º–±–æ—á–∫–∏ ---
        function isTumbPurchased() {
            return purchasedItems.some(item => normalizeCategory(item.category) === '–¢—É–º–±–æ—á–∫–∏');
        }

        function openFarmLockModal() {
            document.getElementById('farmLockModal').style.display = 'flex';
        }
        function closeFarmLockModal() {
            document.getElementById('farmLockModal').style.display = 'none';
        }
        // –¢–∞–∫–æ–∂ –∑–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª–∫—É –ø–æ –∫–ª—ñ–∫—É –Ω–∞ —Ñ–æ–Ω
        const farmLockModal = document.getElementById('farmLockModal');
        if (farmLockModal) {
            farmLockModal.addEventListener('click', function (e) {
                if (e.target === farmLockModal) closeFarmLockModal();
            });
        }

        // === –î–æ–¥–∞—é –∑–º—ñ–Ω–Ω—ñ –¥–ª—è –∫–∞–∫—Ç—É—Å–∞ ===
        let cactusGalleryInterval = null;
        let cactusCurrentStage = 0;
        let cactusNextTs = 0;
        const cactusImages = [
            'shop/–§–∞—Ä–º–ö-1.png',
            'shop/–§–∞—Ä–º–ö-2.png',
            'shop/–§–∞—Ä–º–ö-3.png',
            'shop/–§–∞—Ä–º–ö-4.png'
        ];

        function startCactusGallery() {
            const gallery = document.getElementById('flowerGallery');
            if (!gallery) return;
            gallery.style.display = 'flex';
            cactusCurrentStage = 0;
            renderCactusGallery();
            startCactusInterval();
        }

        function renderCactusGallery() {
            const gallery = document.getElementById('flowerGallery');
            if (!gallery) return;
            gallery.innerHTML = '';
            if (cactusCurrentStage === 3) {
                const label = document.createElement('div');
                label.className = 'harvest-label-cactus';
                label.innerHTML = '–£—Ä–æ–∂–∞–π <span style="font-size:21px;">‚Üì</span>';
                gallery.appendChild(label);
            }
            const img = document.createElement('img');
            img.src = cactusImages[cactusCurrentStage];
            if (cactusCurrentStage === 0) {
                img.className = 'cactus-img small';
            } else if (cactusCurrentStage === 1) {
                img.className = 'cactus-img stage2';
            } else if (cactusCurrentStage === 2) {
                img.className = 'cactus-img stage3';
            } else if (cactusCurrentStage === 3) {
                img.className = 'cactus-img stage4';
            } else {
                img.className = 'flower-img';
            }
            img.alt = `–ö–∞–∫—Ç—É—Å –µ—Ç–∞–ø ${cactusCurrentStage + 1}`;
            if (cactusCurrentStage === 3) {
                img.style.cursor = 'pointer';
                img.onclick = function () {
                    coins += HARVEST_REWARD_CACTUS;
                    updateBalanceUI();
                    registerFarmHarvestTask();
                    cactusCurrentStage = 0;
                    renderCactusGallery();
                    startCactusInterval();
                };
            } else {
                img.onclick = null;
                img.style.cursor = 'default';
            }
            gallery.appendChild(img);
        }

        function startCactusInterval() {
            if (cactusGalleryInterval) clearInterval(cactusGalleryInterval);
            const now = nowMs();
            const nextTs = cactusNextTs && cactusNextTs > now ? cactusNextTs : now + FARM_STAGE_MS;
            const delay = nextTs - now;
            setTimeout(() => {
                if (cactusCurrentStage < 3) {
                    cactusCurrentStage++;
                    cactusNextTs = nowMs() + FARM_STAGE_MS;
                    renderCactusGallery();
                    saveGameState();
                    if (cactusCurrentStage === 3) return;
                    cactusGalleryInterval = setInterval(() => {
                        if (cactusCurrentStage < 3) {
                            cactusCurrentStage++;
                            cactusNextTs = nowMs() + FARM_STAGE_MS;
                            renderCactusGallery();
                            saveGameState();
                            if (cactusCurrentStage === 3) clearInterval(cactusGalleryInterval);
                        }
                    }, FARM_STAGE_MS);
                }
            }, delay);
        }

        // === –ì–∞–ª–µ—Ä–µ—è —Ä–æ—Å—Ç—É –≥—Ä–∏–±–æ—á–∫–∞ ===
        let mushroomGalleryInterval = null;
        let mushroomCurrentStage = 0;
        let mushroomNextTs = 0;
        const mushroomImages = [
            'shop/–ì—Ä–∏–±-1.png',
            'shop/–ì—Ä–∏–±-2.png',
            'shop/–ì—Ä–∏–±-3.png',
            'shop/–ì—Ä–∏–±-4.png'
        ];

        function startMushroomGallery() {
            const gallery = document.getElementById('flowerGallery');
            if (!gallery) return;
            gallery.style.display = 'flex';
            mushroomCurrentStage = 0;
            renderMushroomGallery();
            startMushroomInterval();
        }

        function renderMushroomGallery() {
            const gallery = document.getElementById('flowerGallery');
            if (!gallery) return;
            gallery.innerHTML = '';
            if (mushroomCurrentStage === 3) {
                const label = document.createElement('div');
                label.className = 'harvest-label-mushroom';
                label.innerHTML = '–£—Ä–æ–∂–∞–π <span style="font-size:21px;">‚Üì</span>';
                gallery.appendChild(label);
            }
            const img = document.createElement('img');
            img.src = mushroomImages[mushroomCurrentStage];
            img.className = 'flower-img';
            img.alt = `–ì—Ä–∏–± –µ—Ç–∞–ø ${mushroomCurrentStage + 1}`;
            // –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –≥—Ä–∏–±–æ—á–∫–∞: –ø–µ—Ä—à–µ —Ñ–æ—Ç–æ ~50% –≤—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É, —ñ–Ω—à—ñ ‚Äî ~10% –º–µ–Ω—à—ñ
            if (mushroomCurrentStage === 0) {
                // 50% –≤—ñ–¥ –±–∞–∑–æ–≤–æ—ó –≤–∏—Å–æ—Ç–∏ 82px ‚âà 41px
                img.style.height = '25px';
            } else {
                // 10% –º–µ–Ω—à–µ –≤—ñ–¥ 82px ‚âà 74px
                img.style.height = '50px';
            }
            if (mushroomCurrentStage === 3) {
                img.style.cursor = 'pointer';
                img.onclick = function () {
                    coins += HARVEST_REWARD_MUSHROOM;
                    updateBalanceUI();
                    registerFarmHarvestTask();
                    mushroomCurrentStage = 0;
                    renderMushroomGallery();
                    startMushroomInterval();
                };
            } else {
                img.onclick = null;
                img.style.cursor = 'default';
            }
            gallery.appendChild(img);
        }

        function startMushroomInterval() {
            if (mushroomGalleryInterval) clearInterval(mushroomGalleryInterval);
            const now = nowMs();
            const nextTs = mushroomNextTs && mushroomNextTs > now ? mushroomNextTs : now + FARM_STAGE_MS;
            const delay = nextTs - now;
            setTimeout(() => {
                if (mushroomCurrentStage < 3) {
                    mushroomCurrentStage++;
                    mushroomNextTs = nowMs() + FARM_STAGE_MS;
                    renderMushroomGallery();
                    saveGameState();
                    if (mushroomCurrentStage === 3) return;
                    mushroomGalleryInterval = setInterval(() => {
                        if (mushroomCurrentStage < 3) {
                            mushroomCurrentStage++;
                            mushroomNextTs = nowMs() + FARM_STAGE_MS;
                            renderMushroomGallery();
                            saveGameState();
                            if (mushroomCurrentStage === 3) clearInterval(mushroomGalleryInterval);
                        }
                    }, FARM_STAGE_MS);
                }
            }, delay);
        }

        function spawnFallingCoin() {
            const el = document.createElement('div');
            el.style.position = 'fixed';
            el.style.top = '-40px';
            el.style.left = `${Math.floor(Math.random() * (window.innerWidth - 40))}px`;
            el.style.fontSize = '32px';
            el.style.lineHeight = '32px';
            el.style.width = '32px';
            el.style.height = '32px';
            el.style.textAlign = 'center';
            el.style.cursor = 'pointer';
            el.style.zIndex = '9999';
            el.style.transition = 'transform 4s linear';
            el.textContent = 'ü™ô';
            let rewarded = false;
            el.onclick = function () {
                if (rewarded) return;
                rewarded = true;
                coins += FALL_COIN_REWARD;
                updateBalanceUI();
                
                // Track for daily complex task
                if (timeLeft(tasksState.dailyComplex.nextAvailable) === 0) {
                    tasksState.dailyComplex.coinsCaught++;
                    checkDailyComplexTask();
                    saveTasksState();
                }

                if (el.parentNode) el.parentNode.removeChild(el);
            };
            document.body.appendChild(el);
            setTimeout(() => {
                el.style.transform = `translateY(${window.innerHeight + 80}px)`;
            }, 20);
            setTimeout(() => {
                if (el.parentNode) el.parentNode.removeChild(el);
            }, 4000);
        }

        function startFallingCoins() {
            setInterval(spawnFallingCoin, FALL_COIN_INTERVAL_MS);
        }

        function restoreSecretCats() {
            purchasedItems.forEach(item => {
                if (normalizeCategory(item.category) === '–¢–∞—î–º–Ω–∞') {
                    if (item.id === 1) {
                        const bc = document.querySelector('.black-cat');
                        if (bc) bc.style.display = 'block';
                    } else if (item.id === 2) {
                        const bb = document.querySelector('.baby-cat');
                        if (bb) bb.style.display = 'block';
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadGameState();
            loadTasksState();
            initializeBowl();
            restoreSecretCats();
            updateBalanceUI();
            updateBars();
            startFallingCoins();

            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–Ω–æ–ø–æ–∫ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ —Å–µ–∫—Ä–µ—Ç—É
            const buyBtn = document.getElementById('secretUnlockBuyBtn');
            const cancelBtn = document.getElementById('secretUnlockCancelBtn');
            if (buyBtn) buyBtn.onclick = tryUnlockSecret;
            if (cancelBtn) cancelBtn.onclick = closeSecretUnlockModal;

            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–Ω–æ–ø–æ–∫ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
            const delYes = document.getElementById('deleteConfirmYes');
            const delNo = document.getElementById('deleteConfirmNo');
            if (delYes) delYes.onclick = function () {
                if (deleteConfirmCallback) deleteConfirmCallback();
                hideDeleteConfirm();
            };
            if (delNo) delNo.onclick = hideDeleteConfirm;
        });

    </script>

</body>

</html>
